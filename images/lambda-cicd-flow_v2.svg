<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 650" width="900" height="650">
  <style>
    text { font-family: sans-serif; fill: #333; }
    .title { font-size: 20px; font-weight: bold; }
    .heading { font-size: 16px; font-weight: bold; fill: #1976d2; }
    .box-text { font-size: 12px; font-weight: bold; }
    .small { font-size: 10px; fill: #666; }
  </style>
  
  <defs>
    <marker id="arr" markerWidth="8" markerHeight="8" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#666" />
    </marker>
  </defs>
  
  <rect width="900" height="650" fill="#fafafa"/>
  
  <!-- Title -->
  <text x="450" y="30" class="title" text-anchor="middle">CI/CD Flow (Lambroll + Terraform)</text>
  
  <!-- Section 1: Development Flow -->
  <text x="30" y="60" class="heading">1. Development Flow (Auto Deploy to Staging)</text>
  
  <!-- Developer -->
  <circle cx="80" cy="100" r="25" fill="#e3f2fd" stroke="#1976d2" stroke-width="2"/>
  <text x="80" y="103" class="box-text" text-anchor="middle">Dev</text>
  
  <!-- Git -->
  <rect x="150" y="80" width="90" height="40" rx="5" fill="#e3f2fd" stroke="#1976d2" stroke-width="2"/>
  <text x="195" y="105" class="box-text" text-anchor="middle">Git Push</text>
  
  <!-- GitHub Actions -->
  <rect x="290" y="80" width="90" height="40" rx="5" fill="#e3f2fd" stroke="#1976d2" stroke-width="2"/>
  <text x="335" y="105" class="box-text" text-anchor="middle">GH Actions</text>
  
  <!-- Get TF outputs -->
  <rect x="430" y="80" width="90" height="40" rx="5" fill="#fff3e0" stroke="#ff9800" stroke-width="2"/>
  <text x="475" y="98" class="box-text" text-anchor="middle">TF outputs</text>
  <text x="475" y="112" class="small" text-anchor="middle">to env vars</text>
  
  <!-- Lambroll -->
  <rect x="570" y="80" width="90" height="40" rx="5" fill="#e8f5e9" stroke="#4caf50" stroke-width="2"/>
  <text x="615" y="105" class="box-text" text-anchor="middle">Lambroll</text>
  
  <!-- Staging -->
  <rect x="710" y="80" width="90" height="40" rx="5" fill="#fff3e0" stroke="#ff9800" stroke-width="2"/>
  <text x="755" y="105" class="box-text" text-anchor="middle">staging v16</text>
  
  <!-- Arrows -->
  <line x1="105" y1="100" x2="150" y2="100" stroke="#666" stroke-width="2" marker-end="url(#arr)"/>
  <line x1="240" y1="100" x2="290" y2="100" stroke="#666" stroke-width="2" marker-end="url(#arr)"/>
  <line x1="380" y1="100" x2="430" y2="100" stroke="#666" stroke-width="2" marker-end="url(#arr)"/>
  <line x1="520" y1="100" x2="570" y2="100" stroke="#666" stroke-width="2" marker-end="url(#arr)"/>
  <line x1="660" y1="100" x2="710" y2="100" stroke="#666" stroke-width="2" marker-end="url(#arr)"/>
  
  <text x="120" y="95" class="small">commit</text>
  <text x="255" y="95" class="small">trigger</text>
  <text x="395" y="95" class="small">get</text>
  <text x="535" y="95" class="small">deploy</text>
  <text x="675" y="95" class="small">update</text>
  
  <!-- Section 2: Release Flow -->
  <text x="30" y="180" class="heading">2. Release Flow (Manual Approval to Production)</text>
  
  <!-- Staging -->
  <rect x="30" y="200" width="110" height="55" rx="5" fill="#fff3e0" stroke="#ff9800" stroke-width="2"/>
  <text x="85" y="220" class="box-text" text-anchor="middle">staging v16</text>
  <text x="85" y="235" class="small" text-anchor="middle">QA confirmed</text>
  
  <!-- Approval -->
  <rect x="180" y="200" width="110" height="55" rx="5" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2"/>
  <text x="235" y="220" class="box-text" text-anchor="middle">Approval</text>
  <text x="235" y="235" class="small" text-anchor="middle">Slack + GitHub</text>
  
  <!-- Manual -->
  <rect x="330" y="200" width="110" height="55" rx="5" fill="#fff9c4" stroke="#fbc02d" stroke-width="2"/>
  <text x="385" y="220" class="box-text" text-anchor="middle">Manual OK</text>
  <text x="385" y="235" class="small" text-anchor="middle">Infra Team</text>
  
  <!-- Alias Switch -->
  <rect x="480" y="200" width="110" height="55" rx="5" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2"/>
  <text x="535" y="220" class="box-text" text-anchor="middle">Alias Switch</text>
  <text x="535" y="235" class="small" text-anchor="middle">v15 → v16</text>
  
  <!-- Production -->
  <rect x="630" y="200" width="110" height="55" rx="5" fill="#e8f5e9" stroke="#4caf50" stroke-width="3"/>
  <text x="685" y="220" class="box-text" text-anchor="middle">production</text>
  <text x="685" y="235" class="small" text-anchor="middle">v16 active</text>
  
  <!-- Arrows -->
  <line x1="140" y1="227" x2="180" y2="227" stroke="#666" stroke-width="2" marker-end="url(#arr)"/>
  <line x1="290" y1="227" x2="330" y2="227" stroke="#666" stroke-width="2" marker-end="url(#arr)"/>
  <line x1="440" y1="227" x2="480" y2="227" stroke="#4caf50" stroke-width="2" marker-end="url(#arr)"/>
  <line x1="590" y1="227" x2="630" y2="227" stroke="#4caf50" stroke-width="2" marker-end="url(#arr)"/>
  
  <!-- Section 3: Canary -->
  <text x="30" y="310" class="heading">3. Canary Release (Progressive Rollout)</text>
  
  <!-- 10% -->
  <rect x="30" y="330" width="140" height="80" rx="5" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2"/>
  <text x="100" y="350" class="box-text" text-anchor="middle">Phase 1: 10%</text>
  <text x="100" y="367" class="small" text-anchor="middle">v15: 90%</text>
  <text x="100" y="382" class="small" text-anchor="middle">v16: 10%</text>
  <rect x="45" y="390" width="110" height="14" rx="2" fill="#e1bee7"/>
  <rect x="45" y="390" width="11" height="14" rx="2" fill="#ba68c8"/>
  
  <!-- Monitor -->
  <rect x="210" y="330" width="140" height="80" rx="5" fill="#fff3e0" stroke="#ff9800" stroke-width="2"/>
  <text x="280" y="350" class="box-text" text-anchor="middle">Monitor 10min</text>
  <text x="230" y="370" class="small">- Error rate</text>
  <text x="230" y="385" class="small">- Latency</text>
  <text x="230" y="400" class="small">- CPU/Memory</text>
  
  <!-- Decision -->
  <polygon points="450,370 490,345 530,370 490,395" fill="#fff9c4" stroke="#fbc02d" stroke-width="2"/>
  <text x="490" y="375" class="box-text" text-anchor="middle">OK?</text>
  
  <!-- 100% -->
  <rect x="580" y="315" width="110" height="60" rx="5" fill="#e8f5e9" stroke="#4caf50" stroke-width="2"/>
  <text x="635" y="335" class="box-text" text-anchor="middle">Phase 2: 100%</text>
  <text x="635" y="352" class="small" text-anchor="middle">v16: 100%</text>
  <rect x="595" y="360" width="80" height="12" rx="2" fill="#4caf50"/>
  
  <!-- Rollback -->
  <rect x="580" y="415" width="110" height="60" rx="5" fill="#ffebee" stroke="#f44336" stroke-width="2"/>
  <text x="635" y="435" class="box-text" text-anchor="middle">Rollback</text>
  <text x="635" y="452" class="small" text-anchor="middle">v16 → v15</text>
  <text x="635" y="467" class="small" text-anchor="middle" fill="#f44336">Instant (5sec)</text>
  
  <!-- Arrows -->
  <line x1="170" y1="370" x2="210" y2="370" stroke="#666" stroke-width="2" marker-end="url(#arr)"/>
  <line x1="350" y1="370" x2="450" y2="370" stroke="#666" stroke-width="2" marker-end="url(#arr)"/>
  <path d="M 490 345 L 490 330 L 580 330" stroke="#4caf50" stroke-width="2" fill="none" marker-end="url(#arr)"/>
  <path d="M 490 395 L 490 445 L 580 445" stroke="#f44336" stroke-width="2" fill="none" marker-end="url(#arr)"/>
  
  <text x="500" y="325" class="small" fill="#4caf50">No issue</text>
  <text x="500" y="440" class="small" fill="#f44336">Issue</text>
  
  <!-- Notes -->
  <rect x="30" y="520" width="840" height="100" rx="5" fill="#e8eaf6" stroke="#3f51b5" stroke-width="2"/>
  <text x="50" y="545" class="box-text">Key Points:</text>
  
  <text x="50" y="565" class="small">• Staging: Auto-deploy on push to main branch</text>
  <text x="50" y="580" class="small">• Production: Manual approval required (Environment protection)</text>
  <text x="50" y="595" class="small">• Canary: Progressive traffic control (10% → monitor → 100%)</text>
  
  <text x="450" y="565" class="small">• Rollback: Instant via alias switch (5 seconds)</text>
  <text x="450" y="580" class="small">• Lambroll: Deploys functions using Terraform outputs</text>
  <text x="450" y="595" class="small">• Versions: All retained for audit trail</text>
</svg>
