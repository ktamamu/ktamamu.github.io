<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 700" width="1000" height="700">
  <defs>
    <linearGradient id="devGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#e3f2fd;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#bbdefb;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="stagingGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#fff3e0;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#ffe0b2;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="prodGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#e8f5e9;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#c8e6c9;stop-opacity:1" />
    </linearGradient>
    
    <filter id="shadow">
      <feGaussianBlur in="SourceAlpha" stdDeviation="2"/>
      <feOffset dx="2" dy="2"/>
      <feComponentTransfer>
        <feFuncA type="linear" slope="0.3"/>
      </feComponentTransfer>
      <feMerge>
        <feMergeNode/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
    
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#666" />
    </marker>
    <marker id="arrowGreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#4caf50" />
    </marker>
    <marker id="arrowOrange" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#ff9800" />
    </marker>
    <marker id="arrowRed" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#f44336" />
    </marker>
  </defs>
  
  <!-- 背景 -->
  <rect width="1000" height="700" fill="#fafafa"/>
  
  <!-- タイトル -->
  <text x="500" y="30" font-family="Arial, sans-serif" font-size="22" font-weight="bold" text-anchor="middle" fill="#333">
    CI/CD フロー図
  </text>
  
  <!-- ========== 開発フロー ========== -->
  <text x="50" y="70" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#1976d2">
    開発フロー（Staging自動デプロイ）
  </text>
  
  <!-- Developer -->
  <g id="developer">
    <circle cx="100" cy="120" r="35" fill="url(#devGrad)" stroke="#1976d2" stroke-width="2" filter="url(#shadow)"/>
    <text x="100" y="115" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#0d47a1">
      Developer
    </text>
    <text x="100" y="130" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#0d47a1">
      (Code)
    </text>
  </g>
  
  <!-- Git Commit -->
  <g id="git-commit">
    <rect x="220" y="90" width="120" height="60" rx="8" fill="url(#devGrad)" stroke="#1976d2" stroke-width="2" filter="url(#shadow)"/>
    <text x="280" y="115" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#0d47a1">
      Git
    </text>
    <text x="280" y="130" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#0d47a1">
      push to main
    </text>
  </g>
  
  <!-- GitHub Actions -->
  <g id="github-actions">
    <rect x="420" y="90" width="120" height="60" rx="8" fill="url(#devGrad)" stroke="#1976d2" stroke-width="2" filter="url(#shadow)"/>
    <text x="480" y="115" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#0d47a1">
      GitHub
    </text>
    <text x="480" y="130" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#0d47a1">
      Actions
    </text>
  </g>
  
  <!-- SAM Deploy -->
  <g id="sam-deploy">
    <rect x="620" y="90" width="120" height="60" rx="8" fill="url(#devGrad)" stroke="#1976d2" stroke-width="2" filter="url(#shadow)"/>
    <text x="680" y="115" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#0d47a1">
      SAM
    </text>
    <text x="680" y="130" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#0d47a1">
      build & deploy
    </text>
  </g>
  
  <!-- Staging Alias -->
  <g id="staging-alias">
    <rect x="820" y="90" width="120" height="60" rx="8" fill="url(#stagingGrad)" stroke="#ff9800" stroke-width="2" filter="url(#shadow)"/>
    <text x="880" y="115" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#e65100">
      staging
    </text>
    <text x="880" y="130" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#e65100">
      → v16
    </text>
  </g>
  
  <!-- 矢印: Developer → Git -->
  <path d="M 135 120 L 220 120" stroke="#1976d2" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  <text x="150" y="110" font-family="Arial, sans-serif" font-size="9" fill="#666">
    コミット
  </text>
  
  <!-- 矢印: Git → GitHub Actions -->
  <path d="M 340 120 L 420 120" stroke="#1976d2" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  <text x="350" y="110" font-family="Arial, sans-serif" font-size="9" fill="#666">
    push
  </text>
  
  <!-- 矢印: GitHub Actions → SAM -->
  <path d="M 540 120 L 620 120" stroke="#1976d2" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  <text x="550" y="110" font-family="Arial, sans-serif" font-size="9" fill="#666">
    trigger
  </text>
  
  <!-- 矢印: SAM → Staging -->
  <path d="M 740 120 L 820 120" stroke="#ff9800" stroke-width="2" fill="none" marker-end="url(#arrowOrange)"/>
  <text x="745" y="110" font-family="Arial, sans-serif" font-size="9" fill="#666">
    自動更新
  </text>
  
  <!-- ========== リリースフロー ========== -->
  <text x="50" y="220" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#4caf50">
    リリースフロー（Production手動承認）
  </text>
  
  <!-- Staging (確認済み) -->
  <g id="staging-verified">
    <rect x="50" y="250" width="140" height="70" rx="8" fill="url(#stagingGrad)" stroke="#ff9800" stroke-width="2" filter="url(#shadow)"/>
    <text x="120" y="275" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#e65100">
      staging
    </text>
    <text x="120" y="292" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#666">
      v16 deployed
    </text>
    <text x="120" y="307" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#4caf50">
      ✓ QA確認済み
    </text>
  </g>
  
  <!-- Approval Request -->
  <g id="approval">
    <rect x="260" y="250" width="140" height="70" rx="8" fill="#e8eaf6" stroke="#5c6bc0" stroke-width="2" filter="url(#shadow)"/>
    <text x="330" y="275" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#283593">
      承認待ち
    </text>
    <text x="330" y="292" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#666">
      Slack通知
    </text>
    <text x="330" y="307" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#666">
      GitHub Environment
    </text>
  </g>
  
  <!-- Manual Approval -->
  <g id="manual-approval">
    <rect x="470" y="250" width="140" height="70" rx="8" fill="#fff9c4" stroke="#fbc02d" stroke-width="2" filter="url(#shadow)"/>
    <text x="540" y="275" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#f57f17">
      手動承認
    </text>
    <text x="540" y="292" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#666">
      インフラチーム
    </text>
    <text x="540" y="307" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#666">
      リードエンジニア
    </text>
  </g>
  
  <!-- Alias Switch -->
  <g id="alias-switch">
    <rect x="680" y="250" width="140" height="70" rx="8" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2" filter="url(#shadow)"/>
    <text x="750" y="275" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#4a148c">
      Alias切替
    </text>
    <text x="750" y="292" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#666">
      production
    </text>
    <text x="750" y="307" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#7b1fa2">
      v15 → v16
    </text>
  </g>
  
  <!-- Production -->
  <g id="production">
    <rect x="890" y="250" width="90" height="70" rx="8" fill="url(#prodGrad)" stroke="#4caf50" stroke-width="3" filter="url(#shadow)"/>
    <text x="935" y="280" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="#1b5e20">
      production
    </text>
    <text x="935" y="300" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#2e7d32">
      v16 稼働
    </text>
  </g>
  
  <!-- 矢印: Staging → Approval -->
  <path d="M 190 285 L 260 285" stroke="#ff9800" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  <text x="195" y="275" font-family="Arial, sans-serif" font-size="9" fill="#666">
    リリース
  </text>
  <text x="195" y="285" font-family="Arial, sans-serif" font-size="9" fill="#666">
    申請
  </text>
  
  <!-- 矢印: Approval → Manual Approval -->
  <path d="M 400 285 L 470 285" stroke="#5c6bc0" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  
  <!-- 矢印: Manual Approval → Alias Switch -->
  <path d="M 610 285 L 680 285" stroke="#4caf50" stroke-width="2" fill="none" marker-end="url(#arrowGreen)"/>
  <text x="620" y="275" font-family="Arial, sans-serif" font-size="9" fill="#4caf50">
    承認
  </text>
  
  <!-- 矢印: Alias Switch → Production -->
  <path d="M 820 285 L 890 285" stroke="#4caf50" stroke-width="2" fill="none" marker-end="url(#arrowGreen)"/>
  
  <!-- ========== カナリアリリース ========== -->
  <text x="50" y="380" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#7b1fa2">
    カナリアリリース（段階的展開）
  </text>
  
  <!-- Phase 1: 10% -->
  <g id="canary-10">
    <rect x="50" y="410" width="180" height="100" rx="8" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2" filter="url(#shadow)"/>
    <text x="140" y="435" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="#4a148c">
      Phase 1: 10%
    </text>
    <text x="140" y="455" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#666">
      v15: 90%
    </text>
    <text x="140" y="470" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#666">
      v16: 10%
    </text>
    <rect x="60" y="480" width="145" height="20" rx="3" fill="#e1bee7" stroke="#9c27b0" stroke-width="1"/>
    <rect x="60" y="480" width="14" height="20" rx="3" fill="#ba68c8"/>
    <text x="132" y="495" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#333">
      トラフィック
    </text>
  </g>
  
  <!-- Monitoring -->
  <g id="monitoring">
    <rect x="290" y="410" width="180" height="100" rx="8" fill="#fff3e0" stroke="#f57c00" stroke-width="2" filter="url(#shadow)"/>
    <text x="380" y="435" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="#e65100">
      監視（10分間）
    </text>
    <text x="380" y="455" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#666">
      • エラー率
    </text>
    <text x="380" y="470" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#666">
      • レイテンシ
    </text>
    <text x="380" y="485" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#666">
      • CPU使用率
    </text>
    <text x="380" y="500" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#666">
      • メモリ使用率
    </text>
  </g>
  
  <!-- Decision -->
  <g id="decision">
    <polygon points="610,460 680,430 750,460 680,490" fill="#fff9c4" stroke="#fbc02d" stroke-width="2" filter="url(#shadow)"/>
    <text x="680" y="463" font-family="Arial, sans-serif" font-size="11" font-weight="bold" text-anchor="middle" fill="#f57f17">
      問題?
    </text>
  </g>
  
  <!-- Phase 2: 100% (Success) -->
  <g id="canary-100">
    <rect x="810" y="380" width="140" height="80" rx="8" fill="url(#prodGrad)" stroke="#4caf50" stroke-width="2" filter="url(#shadow)"/>
    <text x="880" y="405" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="#1b5e20">
      Phase 2: 100%
    </text>
    <text x="880" y="425" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#2e7d32">
      v16: 100%
    </text>
    <rect x="820" y="435" width="120" height="20" rx="3" fill="#4caf50"/>
    <text x="880" y="450" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#fff">
      完全移行
    </text>
  </g>
  
  <!-- Rollback (Failure) -->
  <g id="rollback">
    <rect x="810" y="500" width="140" height="80" rx="8" fill="#ffebee" stroke="#f44336" stroke-width="2" filter="url(#shadow)"/>
    <text x="880" y="525" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="#c62828">
      ロールバック
    </text>
    <text x="880" y="545" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#666">
      v16 → v15
    </text>
    <text x="880" y="565" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#f44336">
      即座に復旧
    </text>
  </g>
  
  <!-- 矢印: 10% → Monitoring -->
  <path d="M 230 460 L 290 460" stroke="#7b1fa2" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  
  <!-- 矢印: Monitoring → Decision -->
  <path d="M 470 460 L 610 460" stroke="#f57c00" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  
  <!-- 矢印: Decision → 100% (No) -->
  <path d="M 680 430 L 680 400 L 810 400" stroke="#4caf50" stroke-width="2" fill="none" marker-end="url(#arrowGreen)"/>
  <text x="710" y="395" font-family="Arial, sans-serif" font-size="10" fill="#4caf50" font-weight="bold">
    問題なし
  </text>
  
  <!-- 矢印: Decision → Rollback (Yes) -->
  <path d="M 680 490 L 680 540 L 810 540" stroke="#f44336" stroke-width="2" fill="none" marker-end="url(#arrowRed)"/>
  <text x="710" y="535" font-family="Arial, sans-serif" font-size="10" fill="#f44336" font-weight="bold">
    問題あり
  </text>
  
  <!-- ========== 補足情報 ========== -->
  <g id="notes">
    <rect x="50" y="600" width="900" height="80" rx="8" fill="#e8eaf6" stroke="#3f51b5" stroke-width="2"/>
    <text x="70" y="625" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#1a237e">
      📝 ポイント
    </text>
    <text x="70" y="645" font-family="Arial, sans-serif" font-size="11" fill="#333">
      • <tspan font-weight="bold">Staging:</tspan> mainブランチへのpushで自動デプロイ（開発速度優先）
    </text>
    <text x="70" y="663" font-family="Arial, sans-serif" font-size="11" fill="#333">
      • <tspan font-weight="bold">Production:</tspan> 手動承認後にリリース（安全性優先）
    </text>
    <text x="500" y="645" font-family="Arial, sans-serif" font-size="11" fill="#333">
      • <tspan font-weight="bold">カナリア:</tspan> 段階的トラフィック制御でリスク最小化
    </text>
    <text x="500" y="663" font-family="Arial, sans-serif" font-size="11" fill="#333">
      • <tspan font-weight="bold">ロールバック:</tspan> エイリアス切替で数秒で復旧可能
    </text>
  </g>
</svg>
