{"posts":[{"title":"Route53ã¨ã‚ªãƒ³ãƒ—ãƒ¬DNSã«ãŠã‘ã‚‹æ¡ä»¶ä»˜ããƒ•ã‚©ãƒ¯ãƒ¼ãƒ€ãƒ¼ã¨å§”ä»»ã®æ§‹æˆæ¯”è¼ƒ","text":"Route 53 ãƒªã‚¾ãƒ«ãƒãƒ¼ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä½¿ã£ãŸãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ›ã‚¹ãƒˆã‚¾ãƒ¼ãƒ³ã¸ã®ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã®å§”ä»»ã«ã¤ã„ã¦ã€Qiita(â€»)ã§è§£èª¬è¨˜äº‹ã‚’æ‹è¦‹ã—ã¦ãã®æ§‹æˆã‚’æ¡ä»¶ä»˜ããƒ•ã‚©ãƒ¯ãƒ¼ãƒ€ãƒ¼ã¨æ¯”ã¹ã‚‹ã¨ã©ã†ãªã‚‹ã‹æ§‹æˆå›³ã«è¡¨ã—ã¦ã¿ã¾ã—ãŸã€‚ ã“ã‚Œã¾ã§ã¯ã‚ªãƒ³ãƒ—ãƒ¬ç’°å¢ƒã®ç‹¬è‡ªãƒ‰ãƒ¡ã‚¤ãƒ³ã®æ¨©å¨ DNS ã‚µãƒ¼ãƒã§ç®¡ç†ã—ã¦ã„ã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³ãŒã‚ã‚Šã€AWSã®Route53ã§ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ç®¡ç†ã—ãŸã„å ´åˆã€Route 53 ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¸ã‚ªãƒ³ãƒ—ãƒ¬ãƒŸã‚¹ã‹ã‚‰ã®åå‰è§£æ±ºã‚¯ã‚¨ãƒªã‚’è»¢é€ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚ï¼ˆæ¡ä»¶ä»˜ããƒ•ã‚©ãƒ¯ãƒ¼ãƒ€ãƒ¼è¨­å®šï¼‰ Route 53 ãƒªã‚¾ãƒ«ãƒãƒ¼ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ›ã‚¹ãƒˆã‚¾ãƒ¼ãƒ³ã¸ã®ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã®å§”ä»»ã‚’è¨­å®šã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ Amazon Route 53 Resolver endpoints now support DNS delegation for private hosted zones æ¨™æº–çš„ãªDNSå§”ä»»æ§‹æˆã¨ãªã‚‹ã®ã§ã€æ¡ä»¶ä»˜ããƒ•ã‚©ãƒ¯ãƒ¼ãƒ€ãƒ¼ã‚ˆã‚Šã‚‚å§”ä»»è¨­å®šãŒæ¨å¥¨ã§ã™ãŒã€Route 53 ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å†ä½œæˆã«ã¯ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åœæ­¢ã‚’ä¼´ã†ç‚¹ã¯æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚ (â€»)Route 53 ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ›ã‚¹ãƒˆã‚¾ãƒ¼ãƒ³ã¸ã‚ªãƒ³ãƒ—ãƒ¬ãƒŸã‚¹ã® DNS ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’å§”ä»»ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã®ã§è©¦ã—ã¦ã¿ãŸ","link":"/2025/06/29/dns_forward/"},{"title":"sshdã®æ¥ç¶šå…ƒã‚’æ—¥æœ¬ã®IPã«é™å®šã™ã‚‹","text":"fetus å›½ï¼åœ°åŸŸåˆ¥IPã‚¢ãƒ‰ãƒ¬ã‚¹å‰²ã‚ŠæŒ¯ã‚Šä¸€è¦§ ã®IPãƒªã‚¹ãƒˆã‚’å–å¾—ã—ã€SSHã®æ¥ç¶šå…ƒã‚’æ—¥æœ¬ã®IPã«é™å®š ç’°å¢ƒæƒ…å ± OS Ubuntu Version 24.04.2 LTS hosts.allowã¨hosts.denyã®è¨­å®š æœ€çµ‚è¡Œã¯æ”¹è¡ŒãŒå¿…è¦ã§ã™ï¼ˆæ”¹è¡ŒãŒãªã„ã¨æ­£å¸¸ã«å‹•ä½œã—ã¾ã›ã‚“ï¼‰ /etc/hosts.allow 12sshd: /etc/jp.allow /etc/hosts.deny 12ALL : ALL ã‚¹ã‚¯ãƒªãƒ—ãƒˆå¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å–å¾—ã—ã¾ã™ 1pip install requests jp_allow.py 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253import requests# IPãƒªã‚¹ãƒˆã‚’å–å¾—ã™ã‚‹URLURL = &quot;https://ipv4.fetus.jp/jp.txt&quot;def convert_subnet(cidr_value): ''' ã‚µãƒ–ãƒãƒƒãƒˆã‚’255.255.255.0å½¢å¼ã«å¤‰æ›ã™ã‚‹é–¢æ•° ''' subnet_map = { 8: &quot;255.0.0.0&quot;, 9: &quot;255.128.0.0&quot;, 10: &quot;255.192.0.0&quot;, 11: &quot;255.224.0.0&quot;, 12: &quot;255.240.0.0&quot;, 13: &quot;255.248.0.0&quot;, 14: &quot;255.252.0.0&quot;, 15: &quot;255.254.0.0&quot;, 16: &quot;255.255.0.0&quot;, 17: &quot;255.255.128.0&quot;, 18: &quot;255.255.192.0&quot;, 19: &quot;255.255.224.0&quot;, 20: &quot;255.255.240.0&quot;, 21: &quot;255.255.248.0&quot;, 22: &quot;255.255.252.0&quot;, 23: &quot;255.255.254.0&quot;, 24: &quot;255.255.255.0&quot;, 25: &quot;255.255.255.128&quot;, 26: &quot;255.255.255.192&quot;, 27: &quot;255.255.255.224&quot;, 28: &quot;255.255.255.240&quot;, 29: &quot;255.255.255.248&quot;, 30: &quot;255.255.255.252&quot;, 31: &quot;255.255.255.254&quot;, 32: &quot;255.255.255.255&quot; } return subnet_map.get(cidr_value)# URLã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—response = requests.get(URL, timeout=5)ip_data = response.text.splitlines()# jp.allowå½¢å¼ã«å¤‰æ›with open(&quot;/etc/jp.allow&quot;, &quot;w&quot;, encoding=&quot;utf-8&quot;) as file: output = [] for line in ip_data: if line and not line.startswith(&quot;#&quot;): # ã‚³ãƒ¡ãƒ³ãƒˆè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ— ip, cidr = line.split('/') subnet = convert_subnet(int(cidr)) output.append(f&quot;{ip}/{subnet}&quot;) file.write(&quot; &quot;.join(output)) # ã‚¹ãƒšãƒ¼ã‚¹ã§åŒºåˆ‡ã£ã¦æ›¸ãè¾¼ã¿print(&quot;IPãƒªã‚¹ãƒˆãŒjp.allowãƒ•ã‚¡ã‚¤ãƒ«ã«å¤‰æ›ã•ã‚Œã¾ã—ãŸã€‚&quot;) å®Ÿè¡Œ /etc ã«æ›¸ãè¾¼ã‚€ãŸã‚ç®¡ç†è€…æ¨©é™ãŒå¿…è¦ã§ã™ 1sudo python jp_allow.py æ³¨æ„ hosts.allowã¨hosts.denyã¯æ¥ç¶šã®åº¦ã«å‹•çš„ã«èª­ã¿è¾¼ã¾ã‚Œã‚‹ã®ã§ã€åˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ç­‰ã§è©¦è¡Œã—ã¦ã‹ã‚‰ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’åˆ‡æ–­ã—ã¦ãã ã•ã„","link":"/2025/06/23/jp_allow/"},{"title":"Lambda CI&#x2F;CD ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ - ç›®æ¬¡","text":"ã“ã®ã‚·ãƒªãƒ¼ã‚ºã«ã¤ã„ã¦AWS Lambdaã®å¤§è¦æ¨¡é‹ç”¨ã«ãŠã„ã¦ã€ãƒ‡ãƒ—ãƒ­ã‚¤ã¨ãƒªãƒªãƒ¼ã‚¹ã‚’åˆ†é›¢ã—ã€å®‰å…¨ã§é«˜é€ŸãªCI/CDã‚’å®Ÿç¾ã™ã‚‹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’è§£èª¬ã—ã¾ã™ã€‚ å¯¾è±¡èª­è€… Lambdaé–¢æ•°ãŒ20å€‹ä»¥ä¸Šã‚ã‚‹ç’°å¢ƒã‚’é‹ç”¨ã—ã¦ã„ã‚‹æ–¹ ãƒ‡ãƒ—ãƒ­ã‚¤é »åº¦ã‚’ä¸Šã’ãŸã„ãŒã€æœ¬ç•ªéšœå®³ã®ãƒªã‚¹ã‚¯ã‚’æ‡¸å¿µã—ã¦ã„ã‚‹æ–¹ Terraformã¨Lambdaãƒ„ãƒ¼ãƒ«ã®ä½¿ã„åˆ†ã‘ã«æ‚©ã‚“ã§ã„ã‚‹æ–¹ ã‚¤ãƒ³ãƒ•ãƒ©ãƒãƒ¼ãƒ ã¨ã‚¢ãƒ—ãƒªãƒãƒ¼ãƒ ã®è²¬ä»»åˆ†é›¢ã‚’æ˜ç¢ºã«ã—ãŸã„æ–¹ å‰æçŸ¥è­˜ AWS Lambdaã€Terraformã€GitHub Actionsã®åŸºæœ¬çš„ãªç†è§£ CI/CDã®æ¦‚å¿µ Infrastructure as Codeã®çµŒé¨“ å…¨ä½“æ§‹æˆ1. CI/CDç’°å¢ƒæ§‹ç¯‰ã«ãŠã‘ã‚‹æ–¹é‡ä½•ã‚’è§£æ±ºã™ã‚‹ã®ã‹ã€ãªãœã“ã®è¨­è¨ˆãªã®ã‹ ãƒ‡ãƒ—ãƒ­ã‚¤ã¨ãƒªãƒªãƒ¼ã‚¹ã®åˆ†é›¢ã¨ã¯ Terraformã¨Lambrollã®ä½¿ã„åˆ†ã‘ ã‚¨ã‚¤ãƒªã‚¢ã‚¹æˆ¦ç•¥ã®æ ¸å¿ƒ è¨­è¨ˆã®3åŸå‰‡ èª­äº†æ™‚é–“: 5åˆ† 2. æ§‹æˆè¦ç´ ã¨å½¹å‰²ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“åƒã¨å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®è²¬ä»» ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³ï¼ˆSVGï¼‰ ãƒªãƒã‚¸ãƒˆãƒªæ§‹æˆ Terraform vs Lambrollã®è²¬ä»»ç¯„å›² ãƒªã‚½ãƒ¼ã‚¹é…ç½®ã®ãƒ«ãƒ¼ãƒ« ã‚¨ã‚¤ãƒªã‚¢ã‚¹ç®¡ç†æˆ¦ç•¥ èª­äº†æ™‚é–“: 10åˆ† 3. å®Ÿè£…ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³å®Ÿéš›ã«æ§‹ç¯‰ã™ã‚‹éš›ã®å…·ä½“çš„ãªæ‰‹é † Terraformå®Ÿè£…ï¼ˆã‚¤ãƒ³ãƒ•ãƒ©ã€IAMã€outputsï¼‰ Lambrollå®Ÿè£…ï¼ˆfunction.jsonlã€Layeræˆ¦ç•¥ï¼‰ GitHub Actionsè¨­å®š ãƒãƒ¼ã‚¸ãƒ§ãƒ³å‰Šé™¤ã®è‡ªå‹•åŒ– ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆç®¡ç† èª­äº†æ™‚é–“: 15åˆ† 4. ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ã¨é‹ç”¨ä¸Šã®è€ƒæ…®ç‚¹æ¡ç”¨åˆ¤æ–­ã®ãŸã‚ã®ç¾å®Ÿçš„ãªè©•ä¾¡ ãƒ¡ãƒªãƒƒãƒˆãƒ»ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ é©ç”¨ã™ã¹ãè¦æ¨¡ å¤±æ•—ãƒ‘ã‚¿ãƒ¼ãƒ³ æ®µéšçš„ãªå°å…¥æˆ¦ç•¥ ã‚ˆãã‚ã‚‹è³ªå•ï¼ˆFAQï¼‰ èª­äº†æ™‚é–“: 8åˆ† ã“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ç‰¹å¾´âœ… å®Ÿç¾ã™ã‚‹ã“ã¨ é«˜é€Ÿãªãƒ‡ãƒ—ãƒ­ã‚¤: mainã¸ã®pushã‹ã‚‰2åˆ†ä»¥å†…ã«stagingã¸åæ˜  å®‰å…¨ãªãƒªãƒªãƒ¼ã‚¹: æ‰‹å‹•æ‰¿èªã«ã‚ˆã‚Šæœ¬ç•ªã¸ã®å½±éŸ¿ã‚’åˆ¶å¾¡ ç¬æ™‚ã®ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯: ã‚¨ã‚¤ãƒªã‚¢ã‚¹åˆ‡æ›¿ã§5ç§’ä»¥å†…ã«å‰ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¸å¾©å¸° æ˜ç¢ºãªè²¬ä»»åˆ†é›¢: ã‚¤ãƒ³ãƒ•ãƒ©ãƒãƒ¼ãƒ ï¼ˆTerraformï¼‰ã¨ã‚¢ãƒ—ãƒªãƒãƒ¼ãƒ ï¼ˆLambrollï¼‰ ã‚«ãƒŠãƒªã‚¢ãƒªãƒªãƒ¼ã‚¹: æ®µéšçš„ãªãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯åˆ¶å¾¡ã«ã‚ˆã‚‹ãƒªã‚¹ã‚¯æœ€å°åŒ– ğŸ¯ æ ¸å¿ƒã®ã‚³ãƒ³ã‚»ãƒ—ãƒˆãƒ‡ãƒ—ãƒ­ã‚¤ â‰  ãƒªãƒªãƒ¼ã‚¹ ãƒ‡ãƒ—ãƒ­ã‚¤: ã‚³ãƒ¼ãƒ‰ã‚’Lambdaã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ â†’ è‡ªå‹•åŒ– ãƒªãƒªãƒ¼ã‚¹: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å…¬é–‹ï¼ˆã‚¨ã‚¤ãƒªã‚¢ã‚¹åˆ‡æ›¿ï¼‰ â†’ æ‰‹å‹•æ‰¿èª ã“ã®åˆ†é›¢ã«ã‚ˆã‚Šã€é–‹ç™ºé€Ÿåº¦ã¨æœ¬ç•ªå®‰å…¨æ€§ã‚’ä¸¡ç«‹ã—ã¾ã™ã€‚ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ ãƒ¬ã‚¤ãƒ¤ãƒ¼ ãƒ„ãƒ¼ãƒ« å½¹å‰² ã‚¤ãƒ³ãƒ•ãƒ© Terraform VPCã€IAMã€RDSã€S3ã€EventBridgeç­‰ Lambda Lambroll é–¢æ•°ã‚³ãƒ¼ãƒ‰ã€è¨­å®šã€ã‚¨ã‚¤ãƒªã‚¢ã‚¹ CI/CD GitHub Actions è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ã€æ‰‹å‹•æ‰¿èªãƒ•ãƒ­ãƒ¼ é€£æº Terraform outputs ã‚¤ãƒ³ãƒ•ãƒ©æƒ…å ±ã®å—ã‘æ¸¡ã— ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆ S3 + Versioning ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ä¿ç®¡ æƒ³å®šã™ã‚‹ç’°å¢ƒè¦æ¨¡âœ… ã“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãŒæœ‰åŠ¹ Lambdaé–¢æ•°: 20å€‹ä»¥ä¸Š ãƒ‡ãƒ—ãƒ­ã‚¤é »åº¦: é€±5å›ä»¥ä¸Š ãƒãƒ¼ãƒ è¦æ¨¡: 3äººä»¥ä¸Šï¼ˆã‚¤ãƒ³ãƒ•ãƒ© + ã‚¢ãƒ—ãƒªé–‹ç™ºï¼‰ æœ¬ç•ªç’°å¢ƒ: ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ è¨±å®¹ä¸å¯ âš ï¸ ã‚ªãƒ¼ãƒãƒ¼ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ã«ãªã‚‹ã‚±ãƒ¼ã‚¹ Lambdaé–¢æ•°: 10å€‹æœªæº€ å€‹äººãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ æœˆ1å›ç¨‹åº¦ã®ãƒªãƒªãƒ¼ã‚¹é »åº¦ PoCãƒ»æ¤œè¨¼ç’°å¢ƒ â†’ ã“ã®å ´åˆã¯Terraformã®ã¿ã§ååˆ†ã§ã™ èª­ã¿é€²ã‚æ–¹ã®ã‚¬ã‚¤ãƒ‰ğŸš€ ã¾ãšã¯å…¨ä½“åƒã‚’æŠŠæ¡ã—ãŸã„ â†’ 1ç« ï¼ˆæ–¹é‡ï¼‰ â†’ 2ç« ï¼ˆæ§‹æˆè¦ç´ ï¼‰ ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³ â†’ 4ç« ï¼ˆFAQï¼‰ ğŸ”§ å®Ÿéš›ã«æ§‹ç¯‰ã—ãŸã„ â†’ 2ç« ï¼ˆæ§‹æˆè¦ç´ ï¼‰ ã§ãƒªãƒã‚¸ãƒˆãƒªæ§‹æˆã‚’ç†è§£ â†’ 3ç« ï¼ˆå®Ÿè£…ã‚¬ã‚¤ãƒ‰ï¼‰ ã‚’é †ã«å®Ÿæ–½ â†’ 4ç« ï¼ˆé‹ç”¨è€ƒæ…®ç‚¹ï¼‰ ã§è½ã¨ã—ç©´ã‚’ç¢ºèª ğŸ’¡ æ¡ç”¨åˆ¤æ–­ã‚’ã—ãŸã„ â†’ 1ç« ï¼ˆæ–¹é‡ï¼‰ ã§è¨­è¨ˆæ€æƒ³ã‚’ç†è§£ â†’ 4ç« ï¼ˆãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ï¼‰ ã§ãƒ¡ãƒªãƒƒãƒˆãƒ»ãƒ‡ãƒ¡ãƒªãƒƒãƒˆã‚’è©•ä¾¡ â†’ è‡ªç’°å¢ƒã®è¦æ¨¡ã¨ç…§ã‚‰ã—åˆã‚ã›ã¦åˆ¤æ–­ è£œè¶³è³‡æ–™é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ Terraformå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ Lambroll GitHub AWS Lambda Versions and Aliases ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰å®Ÿè£…ä¾‹ã¯å„ç« ã«æ²è¼‰ã—ã¦ã„ã¾ã™ãŒã€å®Œå…¨ãªã‚µãƒ³ãƒ—ãƒ«ãƒªãƒã‚¸ãƒˆãƒªã¯ä»¥ä¸‹ã‚’å‚ç…§ï¼š terraform-infrastructureï¼ˆæº–å‚™ä¸­ï¼‰ lambda-applicationsï¼ˆæº–å‚™ä¸­ï¼‰ æ›´æ–°å±¥æ­´ 2025-11-02: åˆç‰ˆå…¬é–‹ï¼ˆSAMç‰ˆï¼‰ 2025-11-XX: Lambrollç‰ˆã«å…¨é¢æ”¹è¨‚ ãã‚Œã§ã¯ã€æ–¹é‡ã®ç« ã‹ã‚‰å§‹ã‚ã¾ã—ã‚‡ã†ã€‚ ğŸ‘‰ 1. CI/CDç’°å¢ƒæ§‹ç¯‰ã«ãŠã‘ã‚‹æ–¹é‡","link":"/2025/11/02/lambda-cicd-00-index/"},{"title":"Lambda CI&#x2F;CD ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ - 1. CI&#x2F;CDç’°å¢ƒæ§‹ç¯‰ã«ãŠã‘ã‚‹æ–¹é‡","text":"ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ§‹æˆ â†’ 1. CI/CDç’°å¢ƒæ§‹ç¯‰ã«ãŠã‘ã‚‹æ–¹é‡ 2. æ§‹æˆè¦ç´ ã¨å½¹å‰² 3. å®Ÿè£…ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ 4. ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ã¨é‹ç”¨ä¸Šã®è€ƒæ…®ç‚¹ ã“ã®ç« ã§ç†è§£ã™ã‚‹ã“ã¨ãªãœã“ã®è¨­è¨ˆãªã®ã‹ï¼Ÿ ã®ç­”ãˆãŒã“ã“ã«ã‚ã‚Šã¾ã™ã€‚ ãƒ‡ãƒ—ãƒ­ã‚¤ã¨ãƒªãƒªãƒ¼ã‚¹ã®åˆ†é›¢ Terraformã¨Lambrollã®ä½¿ã„åˆ†ã‘ã®æœ¬è³ª ã‚¨ã‚¤ãƒªã‚¢ã‚¹æˆ¦ç•¥ãŒå…¨ã¦ã®éµ è¨­è¨ˆã®3ã¤ã®åŸå‰‡ ãƒ‡ãƒ—ãƒ­ã‚¤ã¨ãƒªãƒªãƒ¼ã‚¹ã®åˆ†é›¢å¾“æ¥ã®èª²é¡Œå¤šãã®Lambdaç’°å¢ƒã§ã¯ã€ãƒ‡ãƒ—ãƒ­ã‚¤ = ãƒªãƒªãƒ¼ã‚¹ ã¨ãªã£ã¦ã„ã¾ã™ã€‚ 123ã‚³ãƒ¼ãƒ‰å¤‰æ›´ â†’ ãƒ‡ãƒ—ãƒ­ã‚¤ â†’ å³åº§ã«æœ¬ç•ªåæ˜  â†‘ å±é™ºï¼ å•é¡Œç‚¹: æœ¬ç•ªç’°å¢ƒã§ã„ããªã‚Šã‚³ãƒ¼ãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã‚‹ å•é¡Œç™ºè¦‹æ™‚ã®ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã«æ™‚é–“ãŒã‹ã‹ã‚‹ ãƒ†ã‚¹ãƒˆç’°å¢ƒã¨æœ¬ç•ªç’°å¢ƒã®åˆ‡ã‚Šæ›¿ãˆãŒæ›–æ˜§ è§£æ±ºç­–: ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã«ã‚ˆã‚‹åˆ†é›¢12345678910ãƒ‡ãƒ—ãƒ­ã‚¤: Lambdaé–¢æ•°ã«ã‚³ãƒ¼ãƒ‰ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ â†“ ï¼ˆãƒãƒ¼ã‚¸ãƒ§ãƒ³16ãŒä½œæˆã•ã‚Œã‚‹ï¼‰ â†“stagingã‚¨ã‚¤ãƒªã‚¢ã‚¹ â†’ v16 ã«è‡ªå‹•æ›´æ–°productionã‚¨ã‚¤ãƒªã‚¢ã‚¹ â†’ v15 ã®ã¾ã¾ï¼ˆæ‰‹å‹•ã¾ã§å¾…æ©Ÿï¼‰ â†“ ï¼ˆQAãƒ»æ¤œè¨¼ï¼‰ â†“æ‰‹å‹•æ‰¿èª â†’ productionã‚¨ã‚¤ãƒªã‚¢ã‚¹ â†’ v16 ã«æ›´æ–° ãƒ¡ãƒªãƒƒãƒˆ: ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã‚‚æœ¬ç•ªã«å½±éŸ¿ãªã— stagingç’°å¢ƒã§ååˆ†ã«æ¤œè¨¼ ãƒªãƒªãƒ¼ã‚¹ã¯æ‰¿èªå¾Œã«å³åº§ã«å®Ÿè¡Œï¼ˆã‚¨ã‚¤ãƒªã‚¢ã‚¹åˆ‡æ›¿ã®ã¿ï¼‰ ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚‚ç¬æ™‚ï¼ˆã‚¨ã‚¤ãƒªã‚¢ã‚¹ã‚’æˆ»ã™ã ã‘ï¼‰ Terraformã¨Lambrollã®ä½¿ã„åˆ†ã‘ãªãœ2ã¤ã®ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã†ã®ã‹ï¼Ÿæ ¸å¿ƒ: å¤‰æ›´é »åº¦ã¨ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã®é•ã„ ç‰¹æ€§ Terraform Lambroll å¤‰æ›´é »åº¦ ä½ã„ï¼ˆæœˆ1å›ä»¥ä¸‹ï¼‰ é«˜ã„ï¼ˆæ—¥5å›ä»¥ä¸Šï¼‰ ç®¡ç†å¯¾è±¡ ã‚¤ãƒ³ãƒ•ãƒ©å…¨èˆ¬ Lambdaé–¢æ•°ã®ã¿ å®Ÿè¡Œæ™‚é–“ é•·ã„ï¼ˆ10-30åˆ†ï¼‰ çŸ­ã„ï¼ˆ1-3åˆ†ï¼‰ å½±éŸ¿ç¯„å›² åºƒã„ï¼ˆå…¨ä½“ï¼‰ ç‹­ã„ï¼ˆç‰¹å®šé–¢æ•°ï¼‰ Terraform: ã‚¤ãƒ³ãƒ•ãƒ©ã®çœŸå®Ÿã®æºæ³‰è²¬ä»»ç¯„å›²: VPCã€Subnetã€Security Group IAM Roleã€Policy RDSã€DynamoDBï¼ˆå…±æœ‰ï¼‰ S3 Bucket EventBridgeã€SQS/SNSï¼ˆå…±æœ‰ï¼‰ Lambda Layerï¼ˆARNã®ã¿ï¼‰ ãªãœTerraformã§ç®¡ç†ï¼Ÿ å¤‰æ›´ãŒç¨€ â†’ æ…é‡ãªå¤‰æ›´ç®¡ç†ãŒå¿…è¦ è¤‡æ•°ã‚µãƒ¼ãƒ“ã‚¹ã§å…±æœ‰ â†’ ä¸€å…ƒç®¡ç† ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é‡è¦ â†’ ã‚¤ãƒ³ãƒ•ãƒ©ãƒãƒ¼ãƒ ãŒç®¡ç† Lambroll: Lambdaé–¢æ•°ã«ç‰¹åŒ–è²¬ä»»ç¯„å›²: Lambdaé–¢æ•°ã®ã‚³ãƒ¼ãƒ‰ é–¢æ•°è¨­å®šï¼ˆfunction.jsonlï¼‰ ã‚¨ã‚¤ãƒªã‚¢ã‚¹ç®¡ç† ãªãœLambrollã‚’é¸ã‚“ã ã®ã‹ï¼Ÿ SAMã§ã¯ãªãLambrollã‚’æ¡ç”¨ã—ãŸç†ç”±ï¼š ã‚¤ãƒ³ãƒ•ãƒ©ãƒªã‚½ãƒ¼ã‚¹ã‚’ç®¡ç†ã—ãªã„ SAM: IAMã€VPCç­‰ã‚‚ç®¡ç† â†’ Terraformã¨é‡è¤‡ Lambroll: Lambdaé–¢æ•°ã®ã¿ â†’ è²¬ä»»ãŒæ˜ç¢º Terraform stateã‚’ç›´æ¥å‚ç…§ SAM: SSM Parameter StoreçµŒç”±ã§é€£æº Lambroll: terraform outputã‚’ç’°å¢ƒå¤‰æ•°ã§å‚ç…§ â†’ ã‚·ãƒ³ãƒ—ãƒ« è»½é‡ã§é«˜é€Ÿ SAM: CloudFormationçµŒç”±ï¼ˆé…ã„ï¼‰ Lambroll: AWS APIç›´æ¥ï¼ˆé€Ÿã„ï¼‰ ä¾‹: function.jsonl 1234567891011121314{ &quot;FunctionName&quot;: &quot;user-auth-function&quot;, &quot;Runtime&quot;: &quot;python3.11&quot;, &quot;Role&quot;: &quot;{{ must_env `TF_ROLE_ARN` }}&quot;, &quot;VpcConfig&quot;: { &quot;SubnetIds&quot;: {{ env `TF_SUBNET_IDS` | json_array }}, &quot;SecurityGroupIds&quot;: {{ env `TF_SG_IDS` | json_array }} }, &quot;Environment&quot;: { &quot;Variables&quot;: { &quot;DB_ENDPOINT&quot;: &quot;{{ must_env `TF_RDS_ENDPOINT` }}&quot; } }} Terraform outputsã‚’ç’°å¢ƒå¤‰æ•°ã¨ã—ã¦ç›´æ¥å‚ç…§ã§ãã¾ã™ã€‚ ã‚¨ã‚¤ãƒªã‚¢ã‚¹æˆ¦ç•¥ã®æ ¸å¿ƒã‚¨ã‚¤ãƒªã‚¢ã‚¹ã¨ã¯Lambdaé–¢æ•°ã®ç‰¹å®šãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¸ã®åå‰ä»˜ããƒã‚¤ãƒ³ã‚¿ã§ã™ã€‚ 1234567891011Lambdaé–¢æ•°: user-auth-functionâ”œâ”€â”€ $LATESTï¼ˆå¸¸ã«æœ€æ–°ã‚³ãƒ¼ãƒ‰ï¼‰â”œâ”€â”€ Version 1â”œâ”€â”€ Version 2...â”œâ”€â”€ Version 15ï¼ˆç¾åœ¨ã®æœ¬ç•ªï¼‰â”œâ”€â”€ Version 16ï¼ˆæ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼‰â””â”€â”€ Aliasesï¼ˆãƒã‚¤ãƒ³ã‚¿ï¼‰ â”œâ”€â”€ development â†’ $LATEST â”œâ”€â”€ staging â†’ Version 16 â””â”€â”€ production â†’ Version 15 3ç’°å¢ƒã®æˆ¦ç•¥Developmentç’°å¢ƒ1development ã‚¨ã‚¤ãƒªã‚¢ã‚¹ â†’ $LATEST å¸¸ã«æœ€æ–°ã‚³ãƒ¼ãƒ‰ã‚’å‚ç…§ é–‹ç™ºè€…ã®å‹•ä½œç¢ºèªç”¨ ä¸å®‰å®šã§ã‚‚å•é¡Œãªã— Stagingç’°å¢ƒ1staging ã‚¨ã‚¤ãƒªã‚¢ã‚¹ â†’ æœ€æ–°Versionï¼ˆè‡ªå‹•æ›´æ–°ï¼‰ mainãƒ–ãƒ©ãƒ³ãƒã«merge â†’ è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ â†’ Versionç™ºè¡Œ â†’ stagingæ›´æ–° QAãƒ»çµ±åˆãƒ†ã‚¹ãƒˆç”¨ æœ¬ç•ªãƒªãƒªãƒ¼ã‚¹å‰ã®æœ€çµ‚ç¢ºèª Productionç’°å¢ƒ1production ã‚¨ã‚¤ãƒªã‚¢ã‚¹ â†’ æ‰¿èªã•ã‚ŒãŸVersionï¼ˆæ‰‹å‹•æ›´æ–°ï¼‰ stagingæ¤œè¨¼å®Œäº† â†’ æ‰‹å‹•æ‰¿èª â†’ productionæ›´æ–° ã‚¨ãƒ³ãƒ‰ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ æœ€ã‚‚æ…é‡ã«ç®¡ç† ãªãœã“ã®æˆ¦ç•¥ãªã®ã‹ï¼Ÿé–‹ç™ºé€Ÿåº¦ Ã— æœ¬ç•ªå®‰å…¨æ€§ ã®ä¸¡ç«‹ Development: åˆ¶ç´„ãªã— â†’ é–‹ç™ºé€Ÿåº¦æœ€å¤§åŒ– Staging: è‡ªå‹•åŒ– â†’ æ¤œè¨¼ã‚µã‚¤ã‚¯ãƒ«é«˜é€ŸåŒ– Production: æ‰‹å‹•æ‰¿èª â†’ ãƒªã‚¹ã‚¯æœ€å°åŒ– è¨­è¨ˆã®3åŸå‰‡åŸå‰‡1: å˜ä¸€è²¬ä»»ã®åŸå‰‡å„ãƒ„ãƒ¼ãƒ«ã¯1ã¤ã®è²¬ä»»ã®ã¿ã‚’æŒã¤ 1234567891011Terraform: âœ“ ã‚¤ãƒ³ãƒ•ãƒ©ç®¡ç† âœ— Lambdaé–¢æ•°ã®ã‚³ãƒ¼ãƒ‰Lambroll: âœ“ Lambdaé–¢æ•° âœ— ã‚¤ãƒ³ãƒ•ãƒ©ãƒªã‚½ãƒ¼ã‚¹GitHub Actions: âœ“ CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ âœ— ãƒªã‚½ãƒ¼ã‚¹ç®¡ç† ãƒ¡ãƒªãƒƒãƒˆ: å¤‰æ›´ã®å½±éŸ¿ç¯„å›²ãŒæ˜ç¢º ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãŒå®¹æ˜“ ãƒãƒ¼ãƒ é–“ã®è²¬ä»»åˆ†ç•Œç‚¹ãŒæ˜ç¢º åŸå‰‡2: ç–çµåˆã®åŸå‰‡ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“ã¯é–“æ¥çš„ã«é€£æº 12345Terraform outputs â†“ç’°å¢ƒå¤‰æ•° â†“Lambroll ãƒ¡ãƒªãƒƒãƒˆ: Terraformã®å¤‰æ›´ãŒLambrollã«å½±éŸ¿ã—ãªã„ ç‹¬ç«‹ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤å¯èƒ½ ãƒ†ã‚¹ãƒˆãŒå®¹æ˜“ åŸå‰‡3: ä¸å¤‰æ€§ã®åŸå‰‡Lambda Versionã¯ä¸å¤‰ 123Version 15 â†’ ä¸€åº¦ä½œæˆã—ãŸã‚‰å¤‰æ›´ä¸å¯ â†“ å‰Šé™¤ã®ã¿å¯èƒ½ ãƒ¡ãƒªãƒƒãƒˆ: ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒç¢ºå®Ÿ ç›£æŸ»è¨¼è·¡ãŒæ®‹ã‚‹ ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã®åˆ‡æ›¿ã®ã¿ã§ãƒªãƒªãƒ¼ã‚¹ãƒ»ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ ã¾ã¨ã‚ã“ã®è¨­è¨ˆã®æ ¸å¿ƒã‚¨ã‚¤ãƒªã‚¢ã‚¹ã«ã‚ˆã‚‹ç’°å¢ƒåˆ†é›¢ + ãƒ„ãƒ¼ãƒ«ã®è²¬ä»»åˆ†é›¢ 1234567891011121314151617181920â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ Terraformï¼ˆã‚¤ãƒ³ãƒ•ãƒ©ï¼‰ â”‚â”‚ - VPC, IAM, RDS, S3... â”‚â”‚ - å¤‰æ›´ãŒç¨€ â”‚â”‚ - ã‚¤ãƒ³ãƒ•ãƒ©ãƒãƒ¼ãƒ ãŒç®¡ç† â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â†“ outputsâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ Lambrollï¼ˆLambdaé–¢æ•°ï¼‰ â”‚â”‚ - ã‚³ãƒ¼ãƒ‰ã€è¨­å®š â”‚â”‚ - é »ç¹ã«å¤‰æ›´ â”‚â”‚ - ã‚¢ãƒ—ãƒªãƒãƒ¼ãƒ ãŒç®¡ç† â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â†“ deployâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ Lambda Versions + Aliases â”‚â”‚ - development â†’ $LATEST â”‚â”‚ - staging â†’ v16ï¼ˆè‡ªå‹•ï¼‰ â”‚â”‚ - production â†’ v15ï¼ˆæ‰‹å‹•ï¼‰ â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ å®Ÿç¾ã™ã‚‹ã“ã¨ é«˜é€Ÿãƒ‡ãƒ—ãƒ­ã‚¤: 2åˆ†ä»¥å†… å®‰å…¨ãƒªãƒªãƒ¼ã‚¹: æ‰‹å‹•æ‰¿èª ç¬æ™‚ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯: 5ç§’ä»¥å†… æ˜ç¢ºãªè²¬ä»»: ãƒãƒ¼ãƒ é–“ã®åˆ†æ¥­ æ®µéšçš„å±•é–‹: ã‚«ãƒŠãƒªã‚¢ãƒªãƒªãƒ¼ã‚¹ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—æ–¹é‡ã‚’ç†è§£ã—ãŸã‚‰ã€å…·ä½“çš„ãªæ§‹æˆè¦ç´ ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚ ğŸ‘‰ æ¬¡ã¸: 2. æ§‹æˆè¦ç´ ã¨å½¹å‰²","link":"/2025/11/02/lambda-cicd-01-principles/"},{"title":"Lambda CI&#x2F;CD ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ - 2. æ§‹æˆè¦ç´ ã¨å½¹å‰²","text":"ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ§‹æˆ 1. CI/CDç’°å¢ƒæ§‹ç¯‰ã«ãŠã‘ã‚‹æ–¹é‡ â†’ 2. æ§‹æˆè¦ç´ ã¨å½¹å‰² 3. å®Ÿè£…ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ 4. ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ã¨é‹ç”¨ä¸Šã®è€ƒæ…®ç‚¹ ã“ã®ç« ã§ç†è§£ã™ã‚‹ã“ã¨ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®æ§‹æˆã¨ã€å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®è²¬ä»»ç¯„å›²ã‚’æ˜ç¢ºã«ã—ã¾ã™ã€‚ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å…¨ä½“å›³ ãƒªãƒã‚¸ãƒˆãƒªæ§‹æˆ Terraform vs Lambrollã®è²¬ä»»å¢ƒç•Œ ãƒªã‚½ãƒ¼ã‚¹é…ç½®ã®ãƒ«ãƒ¼ãƒ« ã‚¨ã‚¤ãƒªã‚¢ã‚¹ç®¡ç†ã®å®Ÿéš› ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“å›³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦ ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ: GitHub Organizationï¼ˆ2ãƒªãƒã‚¸ãƒˆãƒªï¼‰ terraform-infrastructure: ã‚¤ãƒ³ãƒ•ãƒ©ç®¡ç† lambda-applications: Lambdaé–¢æ•°ç®¡ç† AWS Account Terraformç®¡ç†ãƒªã‚½ãƒ¼ã‚¹ï¼ˆVPCã€IAMã€RDSç­‰ï¼‰ Lambda Functions + Versions + Aliases S3ï¼ˆã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆä¿ç®¡ï¼‰ é€£æº Terraform outputs â†’ ç’°å¢ƒå¤‰æ•° â†’ Lambroll CI/CDãƒ•ãƒ­ãƒ¼ 3ã¤ã®ãƒ•ã‚§ãƒ¼ã‚º: Development Flow: ã‚³ãƒŸãƒƒãƒˆ â†’ è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ â†’ stagingç’°å¢ƒ Release Flow: æ‰‹å‹•æ‰¿èª â†’ productionç’°å¢ƒ Canary Release: æ®µéšçš„ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯åˆ¶å¾¡ï¼ˆ10% â†’ 100%ï¼‰ ãƒªãƒã‚¸ãƒˆãƒªæ§‹æˆterraform-infrastructureï¼ˆã‚¤ãƒ³ãƒ•ãƒ©ãƒªãƒã‚¸ãƒˆãƒªï¼‰12345678910111213141516171819202122232425262728293031323334353637383940414243444546terraform-infrastructure/â”œâ”€â”€ .github/workflows/â”‚ â”œâ”€â”€ terraform-plan.yml # PRæ™‚: planå®Ÿè¡Œâ”‚ â””â”€â”€ terraform-apply.yml # main mergeæ™‚: applyå®Ÿè¡Œâ”‚â”œâ”€â”€ environments/â”‚ â”œâ”€â”€ production/â”‚ â”‚ â”œâ”€â”€ backend.tfâ”‚ â”‚ â”œâ”€â”€ terraform.tfvarsâ”‚ â”‚ â””â”€â”€ main.tfâ”‚ â”œâ”€â”€ staging/â”‚ â””â”€â”€ development/â”‚â”œâ”€â”€ modules/â”‚ â”œâ”€â”€ vpc/â”‚ â”œâ”€â”€ rds/â”‚ â”œâ”€â”€ lambda-role/â”‚ â””â”€â”€ lambda-layer/ # Layerã®ARNç®¡ç†â”‚â”œâ”€â”€ iam/â”‚ â”œâ”€â”€ lambda-roles.tf # Lambdaå®Ÿè¡Œãƒ­ãƒ¼ãƒ«â”‚ â””â”€â”€ outputs.tfâ”‚â”œâ”€â”€ vpc/â”‚ â”œâ”€â”€ main.tfâ”‚ â”œâ”€â”€ subnets.tfâ”‚ â”œâ”€â”€ security-groups.tfâ”‚ â””â”€â”€ outputs.tfâ”‚â”œâ”€â”€ data-stores/â”‚ â”œâ”€â”€ rds.tfâ”‚ â”œâ”€â”€ dynamodb.tfâ”‚ â””â”€â”€ s3.tfâ”‚â”œâ”€â”€ messaging/â”‚ â”œâ”€â”€ sqs.tfâ”‚ â”œâ”€â”€ sns.tfâ”‚ â””â”€â”€ eventbridge.tfâ”‚â”œâ”€â”€ layers/ # Lambda Layerç®¡ç†â”‚ â”œâ”€â”€ dependencies/â”‚ â”‚ â””â”€â”€ layer.tfâ”‚ â””â”€â”€ company-utils/â”‚ â””â”€â”€ layer.tfâ”‚â””â”€â”€ outputs.tf # å…¨ä½“ã®outputå®šç¾© Terraformã®è²¬ä»»: ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£å…¨èˆ¬ Lambda Layerï¼ˆARNã®ã¿ï¼‰ outputsçµŒç”±ã§Lambrollã«æƒ…å ±æä¾› lambda-applicationsï¼ˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒªãƒã‚¸ãƒˆãƒªï¼‰12345678910111213141516171819202122lambda-applications/â”œâ”€â”€ .github/workflows/â”‚ â”œâ”€â”€ deploy-staging.yml # mainã¸ã®push â†’ stagingè‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤â”‚ â”œâ”€â”€ deploy-production.yml # æ‰‹å‹•æ‰¿èª â†’ productionâ”‚ â””â”€â”€ cleanup-versions.yml # é€±æ¬¡: å¤ã„Versionå‰Šé™¤â”‚â”œâ”€â”€ functions/â”‚ â”œâ”€â”€ user-auth/â”‚ â”‚ â”œâ”€â”€ function.jsonl # Lambrollè¨­å®šâ”‚ â”‚ â”œâ”€â”€ index.py # é–¢æ•°ã‚³ãƒ¼ãƒ‰â”‚ â”‚ â”œâ”€â”€ requirements.txtâ”‚ â”‚ â””â”€â”€ tests/â”‚ â”œâ”€â”€ order-processing/â”‚ â”‚ â”œâ”€â”€ function.jsonlâ”‚ â”‚ â””â”€â”€ index.pyâ”‚ â””â”€â”€ payment-service/â”‚â”œâ”€â”€ scripts/â”‚ â”œâ”€â”€ cleanup-old-versions.py # Versionå‰Šé™¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆâ”‚ â””â”€â”€ canary-release.sh # ã‚«ãƒŠãƒªã‚¢ãƒªãƒªãƒ¼ã‚¹â”‚â””â”€â”€ README.md Lambrollã®è²¬ä»»: Lambdaé–¢æ•°ã®ã‚³ãƒ¼ãƒ‰ã¨function.jsonl ã‚¨ã‚¤ãƒªã‚¢ã‚¹ç®¡ç† ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ»ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç™ºè¡Œ å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®è²¬ä»»ç¯„å›²Terraform: ã‚¤ãƒ³ãƒ•ãƒ©ã®çœŸå®Ÿã®æºæ³‰ç®¡ç†å¯¾è±¡ ã‚«ãƒ†ã‚´ãƒª ãƒªã‚½ãƒ¼ã‚¹ ç†ç”± ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ VPCã€Subnetã€Security Group ã‚¤ãƒ³ãƒ•ãƒ©åŸºç›¤ IAM Lambdaå®Ÿè¡ŒRoleã€Policy ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é‡è¦ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ RDSã€DynamoDBï¼ˆå…±æœ‰ï¼‰ã€S3 è¤‡æ•°ã‚µãƒ¼ãƒ“ã‚¹ã§ä½¿ç”¨ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚° SQS/SNSï¼ˆå…±æœ‰ï¼‰ã€EventBridge è¤‡æ•°ã‚µãƒ¼ãƒ“ã‚¹ã§ä½¿ç”¨ Layer Lambda Layerï¼ˆARNç®¡ç†ï¼‰ ä¾å­˜é–¢ä¿‚ã®ä¸€å…ƒç®¡ç† ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ Secrets Manager ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é‡è¦ Terraform outputsï¼ˆLambrollã¸ã®æƒ…å ±æä¾›ï¼‰12345678910111213141516171819202122232425262728293031323334353637383940# outputs.tf# IAMoutput &quot;lambda_role_arn&quot; { description = &quot;Lambda execution role ARN&quot; value = aws_iam_role.lambda_execution.arn}# VPCoutput &quot;private_subnet_ids&quot; { description = &quot;Private subnet IDs for Lambda&quot; value = aws_subnet.private[*].id}output &quot;lambda_security_group_ids&quot; { description = &quot;Security group IDs for Lambda&quot; value = [aws_security_group.lambda.id]}# RDSoutput &quot;rds_endpoint&quot; { description = &quot;RDS endpoint&quot; value = aws_db_instance.main.endpoint sensitive = true}# Lambda Layeroutput &quot;layer_arns&quot; { description = &quot;Lambda Layer ARNs&quot; value = { dependencies = aws_lambda_layer_version.dependencies.arn company_utils = aws_lambda_layer_version.company_utils.arn }}# S3output &quot;artifact_bucket&quot; { description = &quot;S3 bucket for Lambda artifacts&quot; value = aws_s3_bucket.artifacts.id} Lambroll: Lambdaé–¢æ•°ã«ç‰¹åŒ–ç®¡ç†å¯¾è±¡ Lambdaé–¢æ•°ã®ã‚³ãƒ¼ãƒ‰ function.jsonlï¼ˆé–¢æ•°è¨­å®šï¼‰ ã‚¨ã‚¤ãƒªã‚¢ã‚¹ï¼ˆdevelopmentã€stagingã€productionï¼‰ function.jsonl ã®æ§‹é€ 12345678910111213141516171819{ &quot;FunctionName&quot;: &quot;user-auth-function&quot;, &quot;Runtime&quot;: &quot;python3.11&quot;, &quot;Handler&quot;: &quot;index.handler&quot;, &quot;MemorySize&quot;: 512, &quot;Timeout&quot;: 30, &quot;Role&quot;: &quot;{{ must_env `TF_ROLE_ARN` }}&quot;, &quot;Layers&quot;: {{ env `TF_LAYER_ARNS` | json_array }}, &quot;VpcConfig&quot;: { &quot;SubnetIds&quot;: {{ env `TF_SUBNET_IDS` | json_array }}, &quot;SecurityGroupIds&quot;: {{ env `TF_SG_IDS` | json_array }} }, &quot;Environment&quot;: { &quot;Variables&quot;: { &quot;DB_ENDPOINT&quot;: &quot;{{ must_env `TF_RDS_ENDPOINT` }}&quot;, &quot;LOG_LEVEL&quot;: &quot;INFO&quot; } }} ãƒã‚¤ãƒ³ãƒˆ: {{ must_env }}: ç’°å¢ƒå¤‰æ•°ã‹ã‚‰å¿…é ˆå€¤ã‚’å–å¾— {{ env }}: ç’°å¢ƒå¤‰æ•°ã‹ã‚‰ä»»æ„å€¤ã‚’å–å¾— | json_array: é…åˆ—ã«å¤‰æ› GitHub Actions: CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³Stagingè‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950# .github/workflows/deploy-staging.ymlname: Deploy to Stagingon: push: branches: [main] paths: - 'functions/**'jobs: deploy: runs-on: ubuntu-latest steps: - uses: actions/checkout@v4 # Terraform outputsã‚’å–å¾— - name: Get Terraform outputs run: | cd ../terraform-infrastructure terraform output -json &gt; outputs.json # ç’°å¢ƒå¤‰æ•°ã«è¨­å®š echo &quot;TF_ROLE_ARN=$(jq -r '.lambda_role_arn.value' outputs.json)&quot; &gt;&gt; $GITHUB_ENV echo &quot;TF_SUBNET_IDS=$(jq -r '.private_subnet_ids.value | @json' outputs.json)&quot; &gt;&gt; $GITHUB_ENV echo &quot;TF_SG_IDS=$(jq -r '.lambda_security_group_ids.value | @json' outputs.json)&quot; &gt;&gt; $GITHUB_ENV # Lambrollãƒ‡ãƒ—ãƒ­ã‚¤ - name: Deploy with Lambroll run: | cd functions/user-auth lambroll deploy --log-level info # Versionã‚’ç™ºè¡Œ - name: Publish Version id: version run: | VERSION=$(aws lambda publish-version \\ --function-name user-auth-function \\ --description &quot;Commit: ${{ github.sha }}&quot; \\ --query 'Version' --output text) echo &quot;version=$VERSION&quot; &gt;&gt; $GITHUB_OUTPUT # staging ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã‚’æ›´æ–° - name: Update staging alias run: | aws lambda update-alias \\ --function-name user-auth-function \\ --name staging \\ --function-version ${{ steps.version.outputs.version }} Productionæ‰‹å‹•ãƒªãƒªãƒ¼ã‚¹1234567891011121314151617181920212223242526272829# .github/workflows/deploy-production.ymlname: Release to Productionon: workflow_dispatch: inputs: function_name: description: 'Function name' required: true version: description: 'Version number to release' required: truejobs: release: runs-on: ubuntu-latest environment: production # æ‰‹å‹•æ‰¿èªãŒå¿…è¦ steps: - name: Update production alias run: | aws lambda update-alias \\ --function-name ${{ inputs.function_name }} \\ --name production \\ --function-version ${{ inputs.version }} - name: Notify Slack run: | # Slacké€šçŸ¥å‡¦ç† ãƒªã‚½ãƒ¼ã‚¹é…ç½®ã®ãƒ«ãƒ¼ãƒ«åˆ¤æ–­ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆQ1: å¤‰æ›´é »åº¦ã¯ï¼Ÿ é€±1å›ä»¥ä¸Š â†’ Q2ã¸ æœˆ1å›ä»¥ä¸‹ â†’ Terraform Q2: å…±æœ‰ã•ã‚Œã‚‹ã‹ï¼Ÿ è¤‡æ•°ã‚µãƒ¼ãƒ“ã‚¹ã§ä½¿ç”¨ â†’ Terraform Lambdaå°‚ç”¨ â†’ Lambroll Q3: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é‡è¦åº¦ã¯ï¼Ÿ é«˜ã„ â†’ Terraform æ™®é€š â†’ Lambroll ãƒªã‚½ãƒ¼ã‚¹é…ç½®ãƒãƒˆãƒªãƒƒã‚¯ã‚¹ ãƒªã‚½ãƒ¼ã‚¹ é…ç½® ç†ç”± IAMãƒ­ãƒ¼ãƒ« Terraform ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã€å…±æœ‰ VPC/Subnet/SG Terraform ã‚¤ãƒ³ãƒ•ãƒ©åŸºç›¤ RDS/DynamoDB(å…±æœ‰) Terraform è¤‡æ•°ã‚µãƒ¼ãƒ“ã‚¹ã§ä½¿ç”¨ S3(å…±æœ‰) Terraform è¤‡æ•°ã‚µãƒ¼ãƒ“ã‚¹ã§ä½¿ç”¨ Secrets Manager Terraform ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ EventBridge Pipes Terraform å…±æœ‰ã€ç›£è¦–é‡è¦ SQS/SNS(å…±æœ‰) Terraform è¤‡æ•°ã‚µãƒ¼ãƒ“ã‚¹ã§ä½¿ç”¨ Lambdaé–¢æ•° Lambroll é »ç¹ã«å¤‰æ›´ Lambda Layer Terraform ä¾å­˜é–¢ä¿‚ã®ä¸€å…ƒç®¡ç† SQS/SNS(å°‚ç”¨) Lambroll é–¢æ•°ã¨å¯†çµåˆ EventBridge(å°‚ç”¨) Lambroll é–¢æ•°ã¨å¯†çµåˆ æ³¨æ„: Layerã«ã¤ã„ã¦ Layerã¯Terraformã§ç®¡ç†ã—ã¾ã™ã€‚ç†ç”±: å¤‰æ›´é »åº¦ãŒä½ã„ï¼ˆä¾å­˜é–¢ä¿‚ã®æ›´æ–°ã¯æœˆ1å›ç¨‹åº¦ï¼‰ è¤‡æ•°ã®é–¢æ•°ã§å…±æœ‰ã•ã‚Œã‚‹ ARNã‚’outputsã§æä¾› â†’ LambrollãŒå‚ç…§ ã‚¨ã‚¤ãƒªã‚¢ã‚¹ç®¡ç†æˆ¦ç•¥ã‚¨ã‚¤ãƒªã‚¢ã‚¹æ§‹æˆã®å®Ÿéš›123456789101112user-auth-functionâ”‚â”œâ”€â”€ Versionsâ”‚ â”œâ”€â”€ $LATESTâ”‚ â”œâ”€â”€ 1, 2, 3, ..., 14â”‚ â”œâ”€â”€ 15ï¼ˆç¾åœ¨ã® productionï¼‰â”‚ â””â”€â”€ 16ï¼ˆæœ€æ–°ã€staging ã§æ¤œè¨¼ä¸­ï¼‰â”‚â””â”€â”€ Aliases â”œâ”€â”€ development â†’ $LATEST â”œâ”€â”€ staging â†’ 16 â””â”€â”€ production â†’ 15 å„ç’°å¢ƒã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹æˆ¦ç•¥Development12345# å¸¸ã« $LATEST ã‚’å‚ç…§aws lambda create-alias \\ --function-name user-auth-function \\ --name development \\ --function-version '$LATEST' ç‰¹å¾´: æœ€æ–°ã‚³ãƒ¼ãƒ‰ã‚’å³åº§ã«åæ˜  ä¸å®‰å®šã§ã‚‚å•é¡Œãªã— ãƒ‡ãƒãƒƒã‚°ç”¨ Staging1234567# ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã«è‡ªå‹•æ›´æ–°VERSION=$(aws lambda publish-version ...)aws lambda update-alias \\ --function-name user-auth-function \\ --name staging \\ --function-version $VERSION ç‰¹å¾´: mainã¸ã®pushã§è‡ªå‹•æ›´æ–° QAãƒ»çµ±åˆãƒ†ã‚¹ãƒˆç”¨ æœ¬ç•ªãƒªãƒªãƒ¼ã‚¹å‰ã®æœ€çµ‚ç¢ºèª Production12345# æ‰‹å‹•æ‰¿èªå¾Œã«æ›´æ–°aws lambda update-alias \\ --function-name user-auth-function \\ --name production \\ --function-version 16 ç‰¹å¾´: æ‰‹å‹•æ‰¿èªãŒå¿…é ˆ ã‚¨ãƒ³ãƒ‰ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ æœ€ã‚‚æ…é‡ã«ç®¡ç† ã‚«ãƒŠãƒªã‚¢ãƒªãƒªãƒ¼ã‚¹ï¼ˆæ®µéšçš„å±•é–‹ï¼‰123456789101112131415# Phase 1: 10%ã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«aws lambda update-alias \\ --function-name user-auth-function \\ --name production \\ --function-version 16 \\ --routing-config AdditionalVersionWeights={15=0.9}# 10åˆ†é–“ç›£è¦–sleep 600# Phase 2: å•é¡Œãªã‘ã‚Œã°100%ã«aws lambda update-alias \\ --function-name user-auth-function \\ --name production \\ --function-version 16 é€£æºãƒ¡ã‚«ãƒ‹ã‚ºãƒ Terraform â†’ Lambroll ã®æƒ…å ±ä¼é”1. Terraform outputsã‚’å‡ºåŠ› 12cd terraform-infrastructureterraform output -json &gt; outputs.json 2. ç’°å¢ƒå¤‰æ•°ã«è¨­å®š 123export TF_ROLE_ARN=$(jq -r '.lambda_role_arn.value' outputs.json)export TF_SUBNET_IDS=$(jq -r '.private_subnet_ids.value | @json' outputs.json)export TF_LAYER_ARNS=$(jq -r '.layer_arns.value | to_entries | map(.value) | @json' outputs.json) 3. LambrollãŒfunction.jsonlã§å‚ç…§ 1234{ &quot;Role&quot;: &quot;{{ must_env `TF_ROLE_ARN` }}&quot;, &quot;Layers&quot;: {{ env `TF_LAYER_ARNS` | json_array }}} ãƒ¡ãƒªãƒƒãƒˆ: SSM Parameter Storeä¸è¦ ã‚·ãƒ³ãƒ—ãƒ«ã§é«˜é€Ÿ TerraformãŒå˜ä¸€ã®çœŸå®Ÿã®æºæ³‰ ã¾ã¨ã‚è²¬ä»»ç¯„å›²ã®æ˜ç¢ºåŒ– ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ è²¬ä»» å¤‰æ›´é »åº¦ ç®¡ç†ãƒãƒ¼ãƒ  Terraform ã‚¤ãƒ³ãƒ•ãƒ©å…¨èˆ¬ ä½ ã‚¤ãƒ³ãƒ•ãƒ©ãƒãƒ¼ãƒ  Lambroll Lambdaé–¢æ•° é«˜ ã‚¢ãƒ—ãƒªãƒãƒ¼ãƒ  GitHub Actions CI/CD ä¸­ ä¸¡ãƒãƒ¼ãƒ  é€£æºã®è¦ç‚¹ Terraform outputsãŒæ©‹æ¸¡ã—å½¹ stagingã¯è‡ªå‹•ã€productionã¯æ‰‹å‹• ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã§ç’°å¢ƒã‚’å®Œå…¨åˆ†é›¢ ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ä¸å¤‰ã€ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å®¹æ˜“ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—æ§‹æˆè¦ç´ ã‚’ç†è§£ã—ãŸã‚‰ã€å®Ÿè£…ã®è©³ç´°ã«é€²ã¿ã¾ã—ã‚‡ã†ã€‚ ğŸ‘‰ æ¬¡ã¸: 3. å®Ÿè£…ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³","link":"/2025/11/02/lambda-cicd-02-components/"},{"title":"Lambda CI&#x2F;CD ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ - 3. å®Ÿè£…ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³","text":"ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ§‹æˆ 1. CI/CDç’°å¢ƒæ§‹ç¯‰ã«ãŠã‘ã‚‹æ–¹é‡ 2. æ§‹æˆè¦ç´ ã¨å½¹å‰² â†’ 3. å®Ÿè£…ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ 4. ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ã¨é‹ç”¨ä¸Šã®è€ƒæ…®ç‚¹ ã“ã®ç« ã§ç†è§£ã™ã‚‹ã“ã¨å®Ÿéš›ã«æ§‹ç¯‰ã™ã‚‹éš›ã®å…·ä½“çš„ãªæ‰‹é †ã¨ã‚³ãƒ¼ãƒ‰ä¾‹ã‚’ç¤ºã—ã¾ã™ã€‚ Terraformå®Ÿè£…ï¼ˆã‚¤ãƒ³ãƒ•ãƒ©ã€outputsï¼‰ Lambda Layerç®¡ç† Lambrollå®Ÿè£…ï¼ˆfunction.jsonlã€ãƒ‡ãƒ—ãƒ­ã‚¤ï¼‰ GitHub Actionsè¨­å®š ãƒãƒ¼ã‚¸ãƒ§ãƒ³å‰Šé™¤ã®è‡ªå‹•åŒ– ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆç®¡ç† Phase 1: Terraformå®Ÿè£…IAMãƒ­ãƒ¼ãƒ«ä½œæˆ12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758# iam/lambda-roles.tfresource &quot;aws_iam_role&quot; &quot;lambda_execution&quot; { name = &quot;lambda-execution-role&quot; assume_role_policy = jsonencode({ Version = &quot;2012-10-17&quot; Statement = [{ Effect = &quot;Allow&quot; Principal = { Service = &quot;lambda.amazonaws.com&quot; } Action = &quot;sts:AssumeRole&quot; }] })}# åŸºæœ¬çš„ãªå®Ÿè¡Œæ¨©é™resource &quot;aws_iam_role_policy_attachment&quot; &quot;lambda_basic&quot; { role = aws_iam_role.lambda_execution.name policy_arn = &quot;arn:aws:iam::aws:policy/service-role/AWSLambdaVPCAccessExecutionRole&quot;}# CloudWatch Logsresource &quot;aws_iam_role_policy&quot; &quot;lambda_logging&quot; { name = &quot;lambda-logging&quot; role = aws_iam_role.lambda_execution.id policy = jsonencode({ Version = &quot;2012-10-17&quot; Statement = [{ Effect = &quot;Allow&quot; Action = [ &quot;logs:CreateLogGroup&quot;, &quot;logs:CreateLogStream&quot;, &quot;logs:PutLogEvents&quot; ] Resource = &quot;arn:aws:logs:*:*:*&quot; }] })}# RDSã‚¢ã‚¯ã‚»ã‚¹ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰resource &quot;aws_iam_role_policy&quot; &quot;lambda_rds&quot; { name = &quot;lambda-rds-access&quot; role = aws_iam_role.lambda_execution.id policy = jsonencode({ Version = &quot;2012-10-17&quot; Statement = [{ Effect = &quot;Allow&quot; Action = [ &quot;rds-db:connect&quot; ] Resource = aws_db_instance.main.arn }] })} VPCè¨­å®š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748# vpc/main.tfresource &quot;aws_vpc&quot; &quot;main&quot; { cidr_block = &quot;10.0.0.0/16&quot; enable_dns_hostnames = true enable_dns_support = true tags = { Name = &quot;lambda-vpc&quot; }}resource &quot;aws_subnet&quot; &quot;private&quot; { count = 2 vpc_id = aws_vpc.main.id cidr_block = &quot;10.0.${count.index + 1}.0/24&quot; availability_zone = data.aws_availability_zones.available.names[count.index] tags = { Name = &quot;lambda-private-${count.index + 1}&quot; }}resource &quot;aws_security_group&quot; &quot;lambda&quot; { name = &quot;lambda-sg&quot; description = &quot;Security group for Lambda functions&quot; vpc_id = aws_vpc.main.id # ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ã¯å…¨è¨±å¯ï¼ˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚¢ã‚¯ã‚»ã‚¹ç”¨ï¼‰ egress { from_port = 0 to_port = 0 protocol = &quot;-1&quot; cidr_blocks = [&quot;0.0.0.0/0&quot;] } # ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰ã¯RDSã‹ã‚‰ã®ã¿ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰ ingress { from_port = 0 to_port = 0 protocol = &quot;-1&quot; security_groups = [aws_security_group.rds.id] } tags = { Name = &quot;lambda-sg&quot; }} Lambda Layerç®¡ç†12345678910111213141516171819202122232425# layers/dependencies/layer.tf# ä¾å­˜é–¢ä¿‚Layerï¼ˆpip installç­‰ï¼‰resource &quot;aws_lambda_layer_version&quot; &quot;dependencies&quot; { layer_name = &quot;common-dependencies&quot; filename = &quot;${path.module}/dependencies.zip&quot; source_code_hash = filebase64sha256(&quot;${path.module}/dependencies.zip&quot;) compatible_runtimes = [&quot;python3.11&quot;] lifecycle { create_before_destroy = true }}# ç¤¾å†…å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£Layerresource &quot;aws_lambda_layer_version&quot; &quot;company_utils&quot; { layer_name = &quot;company-utils&quot; filename = &quot;${path.module}/company-utils.zip&quot; source_code_hash = filebase64sha256(&quot;${path.module}/company-utils.zip&quot;) compatible_runtimes = [&quot;python3.11&quot;] lifecycle { create_before_destroy = true }} Layerä½œæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ: 123456#!/bin/bash# layers/dependencies/build.shmkdir -p pythonpip install -r requirements.txt -t python/zip -r dependencies.zip python/ ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆä¿ç®¡ç”¨S3123456789101112131415161718192021222324252627# data-stores/s3.tfresource &quot;aws_s3_bucket&quot; &quot;artifacts&quot; { bucket = &quot;company-lambda-artifacts&quot;}resource &quot;aws_s3_bucket_versioning&quot; &quot;artifacts&quot; { bucket = aws_s3_bucket.artifacts.id versioning_configuration { status = &quot;Enabled&quot; }}# ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒãƒªã‚·ãƒ¼ï¼ˆ90æ—¥ä»¥ä¸Šå‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å‰Šé™¤ï¼‰resource &quot;aws_s3_bucket_lifecycle_configuration&quot; &quot;artifacts&quot; { bucket = aws_s3_bucket.artifacts.id rule { id = &quot;delete-old-versions&quot; status = &quot;Enabled&quot; noncurrent_version_expiration { noncurrent_days = 90 } }} Terraform outputs1234567891011121314151617181920212223242526272829303132333435# outputs.tfoutput &quot;lambda_role_arn&quot; { description = &quot;Lambda execution role ARN&quot; value = aws_iam_role.lambda_execution.arn}output &quot;private_subnet_ids&quot; { description = &quot;Private subnet IDs for Lambda&quot; value = aws_subnet.private[*].id}output &quot;lambda_security_group_ids&quot; { description = &quot;Security group IDs for Lambda&quot; value = [aws_security_group.lambda.id]}output &quot;rds_endpoint&quot; { description = &quot;RDS endpoint&quot; value = aws_db_instance.main.endpoint sensitive = true}output &quot;layer_arns&quot; { description = &quot;Lambda Layer ARNs&quot; value = { dependencies = aws_lambda_layer_version.dependencies.arn company_utils = aws_lambda_layer_version.company_utils.arn }}output &quot;artifact_bucket&quot; { description = &quot;S3 bucket for Lambda artifacts&quot; value = aws_s3_bucket.artifacts.id} Phase 2: Lambrollå®Ÿè£…function.jsonlä½œæˆ1234567891011121314151617181920212223242526// functions/user-auth/function.jsonl{ &quot;FunctionName&quot;: &quot;user-auth-function&quot;, &quot;Description&quot;: &quot;User authentication handler&quot;, &quot;Runtime&quot;: &quot;python3.11&quot;, &quot;Handler&quot;: &quot;index.handler&quot;, &quot;MemorySize&quot;: 512, &quot;Timeout&quot;: 30, &quot;Role&quot;: &quot;{{ must_env `TF_ROLE_ARN` }}&quot;, &quot;Layers&quot;: {{ env `TF_LAYER_ARNS` | json_array }}, &quot;VpcConfig&quot;: { &quot;SubnetIds&quot;: {{ env `TF_SUBNET_IDS` | json_array }}, &quot;SecurityGroupIds&quot;: {{ env `TF_SG_IDS` | json_array }} }, &quot;Environment&quot;: { &quot;Variables&quot;: { &quot;DB_ENDPOINT&quot;: &quot;{{ must_env `TF_RDS_ENDPOINT` }}&quot;, &quot;LOG_LEVEL&quot;: &quot;INFO&quot;, &quot;ENVIRONMENT&quot;: &quot;{{ env `ENVIRONMENT` | default `development` }}&quot; } }, &quot;Tags&quot;: { &quot;ManagedBy&quot;: &quot;Lambroll&quot;, &quot;Team&quot;: &quot;Backend&quot; }} Lambdaé–¢æ•°ã‚³ãƒ¼ãƒ‰123456789101112131415161718192021222324252627282930313233343536# functions/user-auth/index.pyimport jsonimport osimport logging# ç’°å¢ƒå¤‰æ•°ã‹ã‚‰è¨­å®šå–å¾—DB_ENDPOINT = os.environ['DB_ENDPOINT']LOG_LEVEL = os.environ.get('LOG_LEVEL', 'INFO')logger = logging.getLogger()logger.setLevel(LOG_LEVEL)def handler(event, context): &quot;&quot;&quot; ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ã®ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ &quot;&quot;&quot; logger.info(f&quot;Received event: {json.dumps(event)}&quot;) try: # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ result = authenticate_user(event) return { 'statusCode': 200, 'body': json.dumps(result) } except Exception as e: logger.error(f&quot;Error: {str(e)}&quot;, exc_info=True) return { 'statusCode': 500, 'body': json.dumps({'error': 'Internal server error'}) }def authenticate_user(event): # èªè¨¼ãƒ­ã‚¸ãƒƒã‚¯ return {'authenticated': True} ã‚¨ã‚¤ãƒªã‚¢ã‚¹åˆæœŸè¨­å®š12345678910111213141516171819# åˆå›ã®ã¿å®Ÿè¡Œ: ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã‚’ä½œæˆ# developmentaws lambda create-alias \\ --function-name user-auth-function \\ --name development \\ --function-version '$LATEST'# stagingï¼ˆåˆæœŸã¯Version 1ã‚’å‚ç…§ï¼‰aws lambda create-alias \\ --function-name user-auth-function \\ --name staging \\ --function-version 1# productionï¼ˆåˆæœŸã¯Version 1ã‚’å‚ç…§ï¼‰aws lambda create-alias \\ --function-name user-auth-function \\ --name production \\ --function-version 1 Phase 3: GitHub Actionsè¨­å®šTerraform CI/CD1234567891011121314151617181920212223242526272829303132333435363738394041# terraform-infrastructure/.github/workflows/terraform-apply.ymlname: Terraform Applyon: push: branches: [main] paths: - '**.tf' - 'environments/**'jobs: terraform: runs-on: ubuntu-latest permissions: id-token: write contents: read steps: - uses: actions/checkout@v4 - uses: hashicorp/setup-terraform@v3 with: terraform_version: 1.6.0 - uses: aws-actions/configure-aws-credentials@v4 with: role-to-assume: ${{ secrets.AWS_TERRAFORM_ROLE_ARN }} aws-region: ap-northeast-1 - name: Terraform Init run: terraform init working-directory: environments/production - name: Terraform Plan run: terraform plan -out=tfplan working-directory: environments/production - name: Terraform Apply run: terraform apply tfplan working-directory: environments/production Lambroll Stagingè‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106# lambda-applications/.github/workflows/deploy-staging.ymlname: Deploy to Stagingon: push: branches: [main] paths: - 'functions/**'jobs: deploy: runs-on: ubuntu-latest permissions: id-token: write contents: read steps: - uses: actions/checkout@v4 - uses: aws-actions/configure-aws-credentials@v4 with: role-to-assume: ${{ secrets.AWS_LAMBDA_ROLE_ARN }} aws-region: ap-northeast-1 # Terraform outputsã‚’å–å¾— - name: Checkout infrastructure repo uses: actions/checkout@v4 with: repository: your-org/terraform-infrastructure path: terraform-infrastructure token: ${{ secrets.GH_TOKEN }} - name: Get Terraform outputs id: tf_outputs run: | cd terraform-infrastructure/environments/production terraform init -backend-config=backend.hcl terraform output -json &gt; outputs.json # ç’°å¢ƒå¤‰æ•°ã«è¨­å®š echo &quot;TF_ROLE_ARN=$(jq -r '.lambda_role_arn.value' outputs.json)&quot; &gt;&gt; $GITHUB_ENV echo &quot;TF_SUBNET_IDS=$(jq -r '.private_subnet_ids.value | @json' outputs.json)&quot; &gt;&gt; $GITHUB_ENV echo &quot;TF_SG_IDS=$(jq -r '.lambda_security_group_ids.value | @json' outputs.json)&quot; &gt;&gt; $GITHUB_ENV echo &quot;TF_RDS_ENDPOINT=$(jq -r '.rds_endpoint.value' outputs.json)&quot; &gt;&gt; $GITHUB_ENV # Layer ARNs LAYERS=$(jq -r '.layer_arns.value | to_entries | map(.value) | @json' outputs.json) echo &quot;TF_LAYER_ARNS=$LAYERS&quot; &gt;&gt; $GITHUB_ENV # Lambrollã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« - name: Setup Lambroll run: | VERSION=&quot;1.0.3&quot; curl -L &quot;https://github.com/fujiwara/lambroll/releases/download/v${VERSION}/lambroll_${VERSION}_linux_amd64.tar.gz&quot; | tar xz sudo mv lambroll /usr/local/bin/ lambroll version # ãƒ‡ãƒ—ãƒ­ã‚¤ - name: Deploy with Lambroll run: | cd functions/user-auth lambroll deploy --log-level info env: ENVIRONMENT: staging # Versionã‚’ç™ºè¡Œ - name: Publish Version id: version run: | VERSION=$(aws lambda publish-version \\ --function-name user-auth-function \\ --description &quot;Commit: ${{ github.sha }}, Actor: ${{ github.actor }}&quot; \\ --query 'Version' \\ --output text) echo &quot;version=$VERSION&quot; &gt;&gt; $GITHUB_OUTPUT echo &quot;Published version: $VERSION&quot; # staging ã‚¨ã‚¤ãƒªã‚¢ã‚¹æ›´æ–° - name: Update staging alias run: | aws lambda update-alias \\ --function-name user-auth-function \\ --name staging \\ --function-version ${{ steps.version.outputs.version }} echo &quot;âœ… Deployed to staging: version ${{ steps.version.outputs.version }}&quot; # Slacké€šçŸ¥ - name: Notify Slack if: always() uses: slackapi/slack-github-action@v1 with: webhook-url: ${{ secrets.SLACK_WEBHOOK_URL }} payload: | { &quot;text&quot;: &quot;Staging Deployment&quot;, &quot;blocks&quot;: [ { &quot;type&quot;: &quot;section&quot;, &quot;text&quot;: { &quot;type&quot;: &quot;mrkdwn&quot;, &quot;text&quot;: &quot;*Deployment Status:* ${{ job.status }}\\n*Function:* user-auth-function\\n*Version:* ${{ steps.version.outputs.version }}\\n*Commit:* ${{ github.sha }}&quot; } } ] } Productionæ‰‹å‹•ãƒªãƒªãƒ¼ã‚¹12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182# lambda-applications/.github/workflows/deploy-production.ymlname: Release to Productionon: workflow_dispatch: inputs: function_name: description: 'Function name to release' required: true type: choice options: - user-auth-function - order-processing-function - payment-service-function version: description: 'Version number (from staging)' required: truejobs: release: runs-on: ubuntu-latest environment: production # æ‰‹å‹•æ‰¿èªãŒå¿…è¦ permissions: id-token: write contents: read steps: - uses: aws-actions/configure-aws-credentials@v4 with: role-to-assume: ${{ secrets.AWS_LAMBDA_ROLE_ARN }} aws-region: ap-northeast-1 # ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ¤œè¨¼ - name: Verify version exists run: | aws lambda get-function \\ --function-name ${{ inputs.function_name }} \\ --qualifier ${{ inputs.version }} # production ã‚¨ã‚¤ãƒªã‚¢ã‚¹æ›´æ–° - name: Update production alias run: | aws lambda update-alias \\ --function-name ${{ inputs.function_name }} \\ --name production \\ --function-version ${{ inputs.version }} # æ¤œè¨¼ - name: Verify deployment run: | CURRENT=$(aws lambda get-alias \\ --function-name ${{ inputs.function_name }} \\ --name production \\ --query 'FunctionVersion' \\ --output text) if [ &quot;$CURRENT&quot; == &quot;${{ inputs.version }}&quot; ]; then echo &quot;âœ… Successfully released version ${{ inputs.version }}&quot; else echo &quot;âŒ Release failed. Current: $CURRENT, Expected: ${{ inputs.version }}&quot; exit 1 fi # Slacké€šçŸ¥ - name: Notify Slack uses: slackapi/slack-github-action@v1 with: webhook-url: ${{ secrets.SLACK_WEBHOOK_URL }} payload: | { &quot;text&quot;: &quot;ğŸš€ Production Release&quot;, &quot;blocks&quot;: [ { &quot;type&quot;: &quot;section&quot;, &quot;text&quot;: { &quot;type&quot;: &quot;mrkdwn&quot;, &quot;text&quot;: &quot;*Function:* ${{ inputs.function_name }}\\n*Version:* ${{ inputs.version }}\\n*Released by:* ${{ github.actor }}&quot; } } ] } Phase 4: ãƒãƒ¼ã‚¸ãƒ§ãƒ³å‰Šé™¤ã®è‡ªå‹•åŒ–å‰Šé™¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆ123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105# scripts/cleanup-old-versions.pyimport boto3from datetime import datetime, timedeltaimport syslambda_client = boto3.client('lambda')def cleanup_old_versions( function_name, keep_versions=10, keep_days=90): &quot;&quot;&quot; å¤ã„Lambdaãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å‰Šé™¤ ä¿æŒãƒ«ãƒ¼ãƒ«: - ã‚¨ã‚¤ãƒªã‚¢ã‚¹ãŒå‚ç…§ã—ã¦ã„ã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ - æœ€æ–°Nå€‹ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ - Næ—¥ä»¥å†…ã«ä½œæˆã•ã‚ŒãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ &quot;&quot;&quot; print(f&quot;Processing {function_name}...&quot;) # ã‚¨ã‚¤ãƒªã‚¢ã‚¹ãŒå‚ç…§ã—ã¦ã„ã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å–å¾— try: aliases = lambda_client.list_aliases(FunctionName=function_name) protected_versions = set( alias['FunctionVersion'] for alias in aliases['Aliases'] if alias['FunctionVersion'] != '$LATEST' ) print(f&quot; Protected versions (by aliases): {protected_versions}&quot;) except Exception as e: print(f&quot; Error getting aliases: {e}&quot;) return # ã™ã¹ã¦ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å–å¾— try: versions = lambda_client.list_versions_by_function( FunctionName=function_name, MaxItems=100 ) except Exception as e: print(f&quot; Error listing versions: {e}&quot;) return # å‰Šé™¤å¯¾è±¡ã‚’æ±ºå®š deletable = [] cutoff_date = datetime.now(datetime.timezone.utc) - timedelta(days=keep_days) for version in versions['Versions']: version_num = version['Version'] # ã‚¹ã‚­ãƒƒãƒ—æ¡ä»¶ if version_num == '$LATEST': continue if version_num in protected_versions: continue last_modified = datetime.fromisoformat( version['LastModified'].replace('Z', '+00:00') ) if last_modified &lt; cutoff_date: deletable.append({ 'version': version_num, 'last_modified': last_modified }) # æœ€æ–°Nå€‹ã¯ä¿æŒï¼ˆæ—¥ä»˜ã§ã‚½ãƒ¼ãƒˆï¼‰ deletable.sort(key=lambda x: x['last_modified'], reverse=True) to_delete = deletable[keep_versions:] print(f&quot; Total versions: {len(versions['Versions'])}&quot;) print(f&quot; Deletable (old): {len(deletable)}&quot;) print(f&quot; Will delete: {len(to_delete)}&quot;) # å‰Šé™¤å®Ÿè¡Œ for item in to_delete: version_num = item['version'] try: lambda_client.delete_function( FunctionName=function_name, Qualifier=version_num ) print(f&quot; âœ… Deleted version {version_num}&quot;) except Exception as e: print(f&quot; âŒ Failed to delete version {version_num}: {e}&quot;)def main(): # ã™ã¹ã¦ã®Lambdaé–¢æ•°ã‚’å–å¾— paginator = lambda_client.get_paginator('list_functions') for page in paginator.paginate(): for func in page['Functions']: function_name = func['FunctionName'] cleanup_old_versions( function_name, keep_versions=10, keep_days=90 ) print()if __name__ == '__main__': main() é€±æ¬¡å®Ÿè¡Œãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼123456789101112131415161718192021222324252627282930313233# lambda-applications/.github/workflows/cleanup-versions.ymlname: Cleanup Old Lambda Versionson: schedule: - cron: '0 0 * * 0' # æ¯é€±æ—¥æ›œæ—¥ 0:00 UTC workflow_dispatch: # æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½jobs: cleanup: runs-on: ubuntu-latest permissions: id-token: write contents: read steps: - uses: actions/checkout@v4 - uses: actions/setup-python@v4 with: python-version: '3.11' - name: Install dependencies run: pip install boto3 - uses: aws-actions/configure-aws-credentials@v4 with: role-to-assume: ${{ secrets.AWS_LAMBDA_ROLE_ARN }} aws-region: ap-northeast-1 - name: Run cleanup run: python scripts/cleanup-old-versions.py Phase 5: ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆç®¡ç†S3ã¸ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰12345678910111213# Staging ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã«ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã‚’ä¿å­˜- name: Build and upload artifact run: | cd functions/user-auth # zipãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ zip -r function.zip index.py requirements.txt # S3ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°æœ‰åŠ¹ï¼‰ ARTIFACT_KEY=&quot;user-auth-function/$(date +%Y%m%d-%H%M%S)-${GITHUB_SHA::7}.zip&quot; aws s3 cp function.zip s3://${{ env.TF_ARTIFACT_BUCKET }}/${ARTIFACT_KEY} echo &quot;artifact_key=$ARTIFACT_KEY&quot; &gt;&gt; $GITHUB_OUTPUT ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ™‚ã®åˆ©ç”¨123456# ç‰¹å®šãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã‚’å–å¾—ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤aws s3 cp s3://company-lambda-artifacts/user-auth-function/20250102-120000-abc1234.zip ./function.zip# å±•é–‹ã—ã¦Lambrollã§ãƒ‡ãƒ—ãƒ­ã‚¤unzip function.ziplambroll deploy ã¾ã¨ã‚å®Ÿè£…ã®æµã‚Œ Phase 1: Terraformï¼ˆã‚¤ãƒ³ãƒ•ãƒ©ã€IAMã€Layerã€outputsï¼‰ Phase 2: Lambrollï¼ˆfunction.jsonlã€ã‚³ãƒ¼ãƒ‰ï¼‰ Phase 3: GitHub Actionsï¼ˆCI/CDã€æ‰‹å‹•æ‰¿èªï¼‰ Phase 4: ãƒãƒ¼ã‚¸ãƒ§ãƒ³å‰Šé™¤ï¼ˆé€±æ¬¡è‡ªå‹•åŒ–ï¼‰ Phase 5: ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆç®¡ç†ï¼ˆS3ä¿ç®¡ï¼‰ ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ Terraform outputsãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ LambrollãŒoutputsã‚’ç’°å¢ƒå¤‰æ•°ã§å‚ç…§ã§ãã‚‹ ã‚¨ã‚¤ãƒªã‚¢ã‚¹ï¼ˆdevelopmentã€stagingã€productionï¼‰ãŒä½œæˆæ¸ˆã¿ GitHub Actionsç’°å¢ƒå¤‰æ•°ãƒ»SecretsãŒè¨­å®šæ¸ˆã¿ S3ãƒã‚±ãƒƒãƒˆï¼ˆã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆä¿ç®¡ï¼‰ãŒä½œæˆæ¸ˆã¿ ãƒãƒ¼ã‚¸ãƒ§ãƒ³å‰Šé™¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒå‹•ä½œã™ã‚‹ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—å®Ÿè£…æ–¹æ³•ã‚’ç†è§£ã—ãŸã‚‰ã€é‹ç”¨ä¸Šã®è€ƒæ…®ç‚¹ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚ ğŸ‘‰ æ¬¡ã¸: 4. ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ã¨é‹ç”¨ä¸Šã®è€ƒæ…®ç‚¹","link":"/2025/11/02/lambda-cicd-03-implementation/"},{"title":"Lambda CI&#x2F;CD ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ - 4. ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ã¨é‹ç”¨ä¸Šã®è€ƒæ…®ç‚¹","text":"ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ§‹æˆ 1. CI/CDç’°å¢ƒæ§‹ç¯‰ã«ãŠã‘ã‚‹æ–¹é‡ 2. æ§‹æˆè¦ç´ ã¨å½¹å‰² 3. å®Ÿè£…ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ â†’ 4. ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ã¨é‹ç”¨ä¸Šã®è€ƒæ…®ç‚¹ ã“ã®ç« ã§ç†è§£ã™ã‚‹ã“ã¨ã“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ç¾å®Ÿçš„ãªè©•ä¾¡ã¨ã€æ¡ç”¨åˆ¤æ–­ã«å¿…è¦ãªæƒ…å ±ã‚’æä¾›ã—ã¾ã™ã€‚ ãƒ¡ãƒªãƒƒãƒˆãƒ»ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ é©ç”¨ã™ã¹ãè¦æ¨¡ã¨ç’°å¢ƒ ã‚ˆãã‚ã‚‹å¤±æ•—ãƒ‘ã‚¿ãƒ¼ãƒ³ æ®µéšçš„ãªå°å…¥æˆ¦ç•¥ FAQ ãƒ¡ãƒªãƒƒãƒˆãƒ»ãƒ‡ãƒ¡ãƒªãƒƒãƒˆâœ… ãƒ¡ãƒªãƒƒãƒˆ1. ãƒ‡ãƒ—ãƒ­ã‚¤é€Ÿåº¦ã®åŠ‡çš„ãªå‘ä¸Šå®Ÿæ¸¬å€¤ï¼ˆ50é–¢æ•°ã®ç’°å¢ƒï¼‰: ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚é–“: 15åˆ† â†’ 2åˆ†ï¼ˆ87%å‰Šæ¸›ï¼‰ ãƒ‡ãƒ—ãƒ­ã‚¤é »åº¦: é€±2å› â†’ æ—¥5å›ï¼ˆ17å€ï¼‰ ç†ç”±: Terraformã®å®Ÿè¡ŒãŒä¸è¦ï¼ˆã‚¤ãƒ³ãƒ•ãƒ©å¤‰æ›´æ™‚ã®ã¿ï¼‰ Lambrollã¯é–¢æ•°ã®ã¿ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆé«˜é€Ÿï¼‰ ä¸¦åˆ—ãƒ‡ãƒ—ãƒ­ã‚¤å¯èƒ½ 2. æœ¬ç•ªéšœå®³ãƒªã‚¹ã‚¯ã®æœ€å°åŒ–ã‚¨ã‚¤ãƒªã‚¢ã‚¹æˆ¦ç•¥ã«ã‚ˆã‚‹ä¿è­·: stagingç’°å¢ƒã§ååˆ†ãªæ¤œè¨¼ æ‰‹å‹•æ‰¿èªã«ã‚ˆã‚Šæ„å›³ã—ãªã„ãƒªãƒªãƒ¼ã‚¹ã‚’é˜²æ­¢ ã‚«ãƒŠãƒªã‚¢ãƒªãƒªãƒ¼ã‚¹ï¼ˆ10% â†’ 100%ï¼‰ã§å½±éŸ¿ç¯„å›²ã‚’åˆ¶å¾¡ å®Ÿç¸¾: æœ¬ç•ªéšœå®³: æœˆ1å› â†’ å››åŠæœŸ1å› ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ™‚é–“: 10åˆ† â†’ 5ç§’ï¼ˆ120å€é«˜é€ŸåŒ–ï¼‰ 3. ãƒãƒ¼ãƒ é–“ã®è²¬ä»»åˆ†é›¢æ˜ç¢ºãªå¢ƒç•Œ: ã‚¤ãƒ³ãƒ•ãƒ©ãƒãƒ¼ãƒ  â†’ Terraformï¼ˆã‚¤ãƒ³ãƒ•ãƒ©å…¨èˆ¬ï¼‰ ã‚¢ãƒ—ãƒªãƒãƒ¼ãƒ  â†’ Lambrollï¼ˆLambdaé–¢æ•°ï¼‰ åŠ¹æœ: ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆå‰Šæ¸› ãƒ¬ãƒ“ãƒ¥ãƒ¼é€Ÿåº¦å‘ä¸Š ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å®¹æ˜“åŒ– 4. ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã®ç¢ºå®Ÿæ€§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ä¸å¤‰æ€§: éå»ã®å…¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒä¿æŒã•ã‚Œã‚‹ ã‚¨ã‚¤ãƒªã‚¢ã‚¹åˆ‡æ›¿ã®ã¿ã§ç¬æ™‚ã«ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ ç›£æŸ»è¨¼è·¡ãŒæ®‹ã‚‹ âŒ ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ1. åˆæœŸæ§‹ç¯‰ã‚³ã‚¹ãƒˆå­¦ç¿’ã‚³ã‚¹ãƒˆ: Lambrollã®ç¿’å¾—ï¼ˆãŸã ã—ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ç°¡æ½”ï¼‰ Terraform outputsã®é€£æºæ–¹æ³• ã‚¨ã‚¤ãƒªã‚¢ã‚¹ç®¡ç†ã®ç†è§£ æ§‹ç¯‰æ™‚é–“: åˆå›æ§‹ç¯‰: ç´„2-3é€±é–“ æ—¢å­˜ç’°å¢ƒã‹ã‚‰ã®ç§»è¡Œ: ç´„1-2ãƒ¶æœˆ 2. ãƒªãƒã‚¸ãƒˆãƒªç®¡ç†ã®è¤‡é›‘åŒ–2ãƒªãƒã‚¸ãƒˆãƒªé‹ç”¨: terraform-infrastructure lambda-applications èª²é¡Œ: ãƒªãƒã‚¸ãƒˆãƒªé–“ã®é€£æºï¼ˆGitHub Actionsï¼‰ outputsã®åŒæœŸ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®åˆ†æ•£ å¯¾ç­–: monorepoåŒ–ã®æ¤œè¨ï¼ˆè¦æ¨¡æ¬¡ç¬¬ï¼‰ æ˜ç¢ºãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™ 3. ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã®æ‰‹é–“Lambda Versionã®å¢—åŠ : ãƒ‡ãƒ—ãƒ­ã‚¤ã”ã¨ã«Versionä½œæˆ ã‚³ãƒ¼ãƒ‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä¸Šé™ï¼ˆ75GB/ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ï¼‰ã«åˆ°é”ãƒªã‚¹ã‚¯ å¯¾ç­–: é€±æ¬¡ã§å¤ã„Versionã‚’è‡ªå‹•å‰Šé™¤ ã‚¨ã‚¤ãƒªã‚¢ã‚¹ä¿è­·ã«ã‚ˆã‚Šå®‰å…¨ã«å‰Šé™¤ 4. Lambrollã®é™å®šçš„ãªã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ SAMã¨ã®æ¯”è¼ƒ: SAM: AWSå…¬å¼ã€è±Šå¯Œãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã€å¤§è¦æ¨¡ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ Lambroll: ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã€é™å®šçš„ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ æ‡¸å¿µ: é•·æœŸçš„ãªãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ æ–°æ©Ÿèƒ½ã¸ã®å¯¾å¿œé€Ÿåº¦ ãƒˆãƒ©ãƒ–ãƒ«æ™‚ã®æƒ…å ±ä¸è¶³ ç¾å®Ÿçš„ãªè©•ä¾¡: æ©Ÿèƒ½ã¯ã‚·ãƒ³ãƒ—ãƒ«ã§å®‰å®š AWS APIã‚’ç›´æ¥åˆ©ç”¨ï¼ˆä¾å­˜åº¦ã¯ä½ã„ï¼‰ å¿…è¦ãªã‚‰SAMã¸ã®ç§»è¡Œã‚‚å¯èƒ½ é©ç”¨ã™ã¹ãè¦æ¨¡ã¨ç’°å¢ƒâœ… ã“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãŒæœ€é©ç’°å¢ƒç‰¹æ€§: Lambdaé–¢æ•°: 20å€‹ä»¥ä¸Š ãƒ‡ãƒ—ãƒ­ã‚¤é »åº¦: é€±5å›ä»¥ä¸Š ãƒãƒ¼ãƒ è¦æ¨¡: 3äººä»¥ä¸Š æœ¬ç•ªç’°å¢ƒ: ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ è¨±å®¹ä¸å¯ ã‚¤ãƒ³ãƒ•ãƒ©ã¨ã‚¢ãƒ—ãƒªã®åˆ†æ¥­: å¿…è¦ ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹: ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹APIï¼ˆAPI Gateway + Lambdaï¼‰ å¤§è¦æ¨¡ãªãƒãƒƒãƒå‡¦ç† âš ï¸ ã‚ªãƒ¼ãƒãƒ¼ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ç’°å¢ƒç‰¹æ€§: Lambdaé–¢æ•°: 10å€‹æœªæº€ ãƒ‡ãƒ—ãƒ­ã‚¤é »åº¦: æœˆ1-2å› ãƒãƒ¼ãƒ è¦æ¨¡: 1-2äºº PoCãƒ»æ¤œè¨¼ç’°å¢ƒ æ¨å¥¨: Terraformã®ã¿ã§ååˆ† CI/CDã‚‚æœ€å°é™ï¼ˆterraform applyï¼‰ ğŸ¤” å¢ƒç•Œç·šä¸Šï¼ˆæ…é‡ã«åˆ¤æ–­ï¼‰Lambdaé–¢æ•°: 10-20å€‹ åˆ¤æ–­åŸºæº–: ãƒ‡ãƒ—ãƒ­ã‚¤é »åº¦ãŒé«˜ã„ â†’ ã“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ ãƒãƒ¼ãƒ åˆ†æ¥­ãŒå¿…è¦ â†’ ã“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ å˜ç´”ãªæ§‹æˆ â†’ Terraformã®ã¿ ã‚ˆãã‚ã‚‹å¤±æ•—ãƒ‘ã‚¿ãƒ¼ãƒ³å¤±æ•—ä¾‹1: ã‚¨ã‚¤ãƒªã‚¢ã‚¹ç®¡ç†ã®ä¸å¾¹åº•å•é¡Œ: 1234# âŒ æ‚ªã„ä¾‹: AutoPublishAliasï¼ˆSAMæ™‚ä»£ã®åæ®‹ï¼‰AutoPublishAlias: live# çµæœ: ãƒ‡ãƒ—ãƒ­ã‚¤ = ãƒªãƒªãƒ¼ã‚¹ï¼ˆæœ¬ç•ªã«å³åæ˜ ï¼‰ å¯¾ç­–: 123# âœ… è‰¯ã„ä¾‹: ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã¯æ‰‹å‹•ç®¡ç†# staging: GitHub Actionsã§è‡ªå‹•æ›´æ–°# production: æ‰‹å‹•æ‰¿èªå¾Œã«æ›´æ–° å­¦ã³: ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã®è‡ªå‹•æ›´æ–°ã¯ staging ã®ã¿ production ã¯å¿…ãšæ‰‹å‹•æ‰¿èª å¤±æ•—ä¾‹2: Terraform outputsã®å‚ç…§å¿˜ã‚Œå•é¡Œ: 123456// âŒ æ‚ªã„ä¾‹: ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰{ &quot;Role&quot;: &quot;arn:aws:iam::123456789012:role/lambda-role&quot;}// çµæœ: Terraformå¤‰æ›´ãŒåæ˜ ã•ã‚Œãªã„ å¯¾ç­–: 1234// âœ… è‰¯ã„ä¾‹: ç’°å¢ƒå¤‰æ•°ã§å‚ç…§{ &quot;Role&quot;: &quot;{{ must_env `TF_ROLE_ARN` }}&quot;} å­¦ã³: ã™ã¹ã¦ã®ã‚¤ãƒ³ãƒ•ãƒ©æƒ…å ±ã¯Terraform outputsçµŒç”± ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã¯çµ¶å¯¾ã«ã—ãªã„ å¤±æ•—ä¾‹3: ãƒãƒ¼ã‚¸ãƒ§ãƒ³å‰Šé™¤ã®å¤±æ•—å•é¡Œ: 12345# âŒ æ‚ªã„ä¾‹: ã‚¨ã‚¤ãƒªã‚¢ã‚¹ä¿è­·ãªã—for version in all_versions: delete_version(version)# çµæœ: productionã‚¨ã‚¤ãƒªã‚¢ã‚¹ãŒå‚ç…§ã™ã‚‹Versionã‚’å‰Šé™¤ å¯¾ç­–: 12345# âœ… è‰¯ã„ä¾‹: ã‚¨ã‚¤ãƒªã‚¢ã‚¹ä¿è­·protected_versions = get_alias_versions()for version in all_versions: if version not in protected_versions: delete_version(version) å­¦ã³: ã‚¨ã‚¤ãƒªã‚¢ã‚¹ãŒå‚ç…§ã™ã‚‹Versionã¯å‰Šé™¤ç¦æ­¢ å‰Šé™¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯æ…é‡ã«ãƒ†ã‚¹ãƒˆ å¤±æ•—ä¾‹4: Layerç®¡ç†ã®åˆ†æ•£å•é¡Œ: 123456# âŒ æ‚ªã„ä¾‹: Lambrollã§Layerç®¡ç†lambda-applications/layers/# çµæœ: - Terraform outputsã¨ã®æ•´åˆæ€§ãŒå–ã‚Œãªã„- è¤‡æ•°é–¢æ•°ã§å…±æœ‰ã—ã¥ã‚‰ã„ å¯¾ç­–: 1234# âœ… è‰¯ã„ä¾‹: Terraformã§Layerç®¡ç†terraform-infrastructure/layers/# Lambrollã¯å‚ç…§ã®ã¿ å­¦ã³: Layerã¯å¤‰æ›´é »åº¦ãŒä½ã„ â†’ Terraform ARNã‚’outputsã§æä¾› â†’ LambrollãŒå‚ç…§ æ®µéšçš„ãªå°å…¥æˆ¦ç•¥Phase 1: å°è¦æ¨¡ã§æ¤œè¨¼ï¼ˆ1-2é€±é–“ï¼‰å¯¾è±¡: Lambdaé–¢æ•°: 1-2å€‹ é‡è¦åº¦ã®ä½ã„æ©Ÿèƒ½ ç›®æ¨™: Terraform + Lambrollã®é€£æºç¢ºèª ã‚¨ã‚¤ãƒªã‚¢ã‚¹æˆ¦ç•¥ã®æ¤œè¨¼ CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ§‹ç¯‰ æˆåŠŸåŸºæº–: stagingè‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå‹•ä½œ productionæ‰‹å‹•ãƒªãƒªãƒ¼ã‚¹ãŒå‹•ä½œ ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒ5ç§’ä»¥å†… Phase 2: æ®µéšçš„æ‹¡å¤§ï¼ˆ1-2ãƒ¶æœˆï¼‰å¯¾è±¡: Lambdaé–¢æ•°: 5-10å€‹ è¤‡æ•°ãƒãƒ¼ãƒ ã§åˆ©ç”¨ ç›®æ¨™: ãƒãƒ¼ãƒ é–“ã®è²¬ä»»åˆ†é›¢ã‚’ç¢ºç«‹ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ‰‹é †ã®ç¢ºç«‹ æˆåŠŸåŸºæº–: è¤‡æ•°ãƒãƒ¼ãƒ ãŒç‹¬ç«‹ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤å¯èƒ½ éšœå®³æ™‚ã®ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒç¢ºå®Ÿ Phase 3: å…¨é¢å±•é–‹ï¼ˆ2-3ãƒ¶æœˆï¼‰å¯¾è±¡: å…¨Lambdaé–¢æ•° å…¨ãƒãƒ¼ãƒ  ç›®æ¨™: æ¨™æº–CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¨ã—ã¦ç¢ºç«‹ é‹ç”¨è‡ªå‹•åŒ–ï¼ˆãƒãƒ¼ã‚¸ãƒ§ãƒ³å‰Šé™¤ç­‰ï¼‰ ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†ã¨æ”¹å–„ ã‚ˆãã‚ã‚‹è³ªå•ï¼ˆFAQï¼‰Q1: SAMã§ã¯ãªãLambrollã‚’é¸ã‚“ã ç†ç”±ã¯ï¼ŸA: è²¬ä»»åˆ†é›¢ã®æ˜ç¢ºåŒ–ã¨ã‚·ãƒ³ãƒ—ãƒ«ã• è¦³ç‚¹ SAM Lambroll ã‚¤ãƒ³ãƒ•ãƒ©ç®¡ç† ã‚ã‚Šï¼ˆé‡è¤‡ï¼‰ ãªã—ï¼ˆæ˜ç¢ºï¼‰ Terraformé€£æº é–“æ¥çš„ï¼ˆSSMï¼‰ ç›´æ¥çš„ï¼ˆoutputsï¼‰ å®Ÿè¡Œé€Ÿåº¦ é…ã„ï¼ˆCFnï¼‰ é€Ÿã„ï¼ˆAPIç›´æ¥ï¼‰ å­¦ç¿’ã‚³ã‚¹ãƒˆ é«˜ã„ ä½ã„ Lambrollã¯ã€ŒLambdaé–¢æ•°ã®ã¿ã€ã«ç‰¹åŒ–ã—ã¦ãŠã‚Šã€Terraformã¨ã®è²¬ä»»åˆ†é›¢ãŒæ˜ç¢ºã§ã™ã€‚ Q2: Lambda Layerã¯èª°ãŒç®¡ç†ã™ã¹ãï¼ŸA: Terraformã§ç®¡ç†ï¼ˆæ¨å¥¨ï¼‰ ç†ç”±: å¤‰æ›´é »åº¦ãŒä½ã„ï¼ˆæœˆ1å›ä»¥ä¸‹ï¼‰ è¤‡æ•°ã®é–¢æ•°ã§å…±æœ‰ã•ã‚Œã‚‹ ARNã‚’outputsã§æä¾›ã™ã‚Œã°Lambrollã‹ã‚‰å‚ç…§å¯èƒ½ ä¾‹å¤–: ç‰¹å®šé–¢æ•°å°‚ç”¨ã®Layer â†’ Lambrollã§ã‚‚å¯ ãŸã ã—ã€Terraformã§çµ±ä¸€ã™ã‚‹æ–¹ãŒã‚·ãƒ³ãƒ—ãƒ« Q3: ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ã©ã‚Œãã‚‰ã„ä¿æŒã™ã¹ãï¼ŸA: æœ€æ–°10å€‹ + 90æ—¥ä»¥å†… + ã‚¨ã‚¤ãƒªã‚¢ã‚¹å‚ç…§ä¸­ ä¿æŒãƒ«ãƒ¼ãƒ«: ã‚¨ã‚¤ãƒªã‚¢ã‚¹ï¼ˆdevelopmentã€stagingã€productionï¼‰ãŒå‚ç…§ä¸­ â†’ å¿…ãšä¿æŒ æœ€æ–°10å€‹ â†’ ä¿æŒï¼ˆãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ï¼‰ 90æ—¥ä»¥å†…ã«ä½œæˆ â†’ ä¿æŒï¼ˆç›£æŸ»ç”¨ï¼‰ ä¸Šè¨˜ä»¥å¤– â†’ å‰Šé™¤ ã‚³ãƒ¼ãƒ‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä¸Šé™å¯¾ç­–: 50é–¢æ•° Ã— 10ãƒãƒ¼ã‚¸ãƒ§ãƒ³ = 500ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 1é–¢æ•°ã‚ãŸã‚Š50MB â†’ 25GBï¼ˆä¸Šé™75GBã®1/3ï¼‰ Q4: ã‚«ãƒŠãƒªã‚¢ãƒªãƒªãƒ¼ã‚¹ã¯å¿…é ˆï¼ŸA: è¦æ¨¡ã¨é‡è¦åº¦ã«ã‚ˆã‚‹ å¿…é ˆã‚±ãƒ¼ã‚¹: ãƒ¦ãƒ¼ã‚¶ãƒ¼å½±éŸ¿ãŒå¤§ãã„ï¼ˆæ±ºæ¸ˆã€èªè¨¼ç­‰ï¼‰ ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ãŒå¤šã„ï¼ˆ1000 req/secä»¥ä¸Šï¼‰ éå»ã«æœ¬ç•ªéšœå®³çµŒé¨“ã‚ã‚Š ä¸è¦ã‚±ãƒ¼ã‚¹: ç¤¾å†…ãƒ„ãƒ¼ãƒ« ãƒãƒƒãƒå‡¦ç†ï¼ˆå®šæœŸå®Ÿè¡Œï¼‰ ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ãŒå°‘ãªã„ æ¨å¥¨: é‡è¦ãªé–¢æ•°ã®ã¿ã‚«ãƒŠãƒªã‚¢ 10% â†’ 10åˆ†ç›£è¦– â†’ 100% Q5: Terraformã®å®Ÿè¡Œé »åº¦ã¯ï¼ŸA: å¿…è¦ãªæ™‚ã®ã¿ï¼ˆé€±1å›ä»¥ä¸‹ï¼‰ å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°: ã‚¤ãƒ³ãƒ•ãƒ©å¤‰æ›´æ™‚ï¼ˆVPCã€RDSè¿½åŠ ç­‰ï¼‰ IAMãƒãƒªã‚·ãƒ¼å¤‰æ›´æ™‚ Layeræ›´æ–°æ™‚ æ–°è¦Lambdaé–¢æ•°ã®åˆå›ä½œæˆæ™‚ï¼ˆé–¢æ•°åã ã‘Terraformã§äºˆç´„ï¼‰ Lambrollã®å®Ÿè¡Œé »åº¦: æ—¥5-10å›ï¼ˆmainã¸ã®pushï¼‰ Q6: æ—¢å­˜ç’°å¢ƒã‹ã‚‰ç§»è¡Œã™ã‚‹ã«ã¯ï¼ŸA: æ®µéšçš„ç§»è¡Œï¼ˆ2-3ãƒ¶æœˆï¼‰ ã‚¹ãƒ†ãƒƒãƒ—: Week 1-2: TerraformåŒ–ï¼ˆã‚¤ãƒ³ãƒ•ãƒ©ã®ã¿ï¼‰ Week 3-4: 1-2é–¢æ•°ã‚’LambrollåŒ–ï¼ˆæ¤œè¨¼ï¼‰ Week 5-8: æ®µéšçš„ã«å…¨é–¢æ•°ã‚’ç§»è¡Œ Week 9-12: CI/CDæ•´å‚™ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ– æ³¨æ„ç‚¹: ä¸€åº¦ã«å…¨ç§»è¡Œã—ãªã„ é‡è¦åº¦ã®ä½ã„é–¢æ•°ã‹ã‚‰é–‹å§‹ ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †ã‚’å¿…ãšæº–å‚™ Q7: LambrollãŒãƒ¡ãƒ³ãƒ†ã•ã‚Œãªããªã£ãŸã‚‰ï¼ŸA: AWS APIã‚’ç›´æ¥åˆ©ç”¨ã—ã¦ã„ã‚‹ãŸã‚å½±éŸ¿ã¯é™å®šçš„ ç¾å®Ÿçš„ãªå¯¾å¿œ: çŸ­æœŸ: forkã—ã¦è‡ªç¤¾ã§ãƒ¡ãƒ³ãƒ†ï¼ˆã‚³ãƒ¼ãƒ‰ã¯éå¸¸ã«ã‚·ãƒ³ãƒ—ãƒ«ï¼‰ ä¸­æœŸ: AWS CLI + ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ä»£æ›¿ é•·æœŸ: SAMã‚„Terraformã«ç§»è¡Œ Lambrollã®ä¾å­˜åº¦ã¯ä½ã„: å˜ãªã‚‹AWS API ã®ãƒ©ãƒƒãƒ‘ãƒ¼ function.jsonl â†’ APIå‘¼ã³å‡ºã—ã®å¤‰æ›ã®ã¿ Q8: ã‚³ã‚¹ãƒˆã¯å¢—ãˆã¾ã™ã‹ï¼ŸA: GitHub Actionså®Ÿè¡Œæ™‚é–“ãŒå¢—ãˆã‚‹ãŒã€ã‚ãšã‹ ã‚³ã‚¹ãƒˆå¢—: GitHub Actionså®Ÿè¡Œæ™‚é–“: æœˆ500åˆ† â†’ 800åˆ†ï¼ˆ+60%ï¼‰ é‡‘é¡: ç´„$0ï¼ˆç„¡æ–™æ å†…ï¼‰ ã‚³ã‚¹ãƒˆæ¸›: ãƒ‡ãƒ—ãƒ­ã‚¤å¤±æ•—ã«ã‚ˆã‚‹æ‰‹æˆ»ã‚Šå‰Šæ¸› éšœå®³å¯¾å¿œæ™‚é–“ã®å‰Šæ¸› äººä»¶è²»å‰Šæ¸›ï¼ˆè‡ªå‹•åŒ–ï¼‰ çµè«–: å®Ÿè³ªçš„ãªã‚³ã‚¹ãƒˆå¢—ã¯ã»ã¼ã‚¼ãƒ­ Q9: Lambdaä»¥å¤–ã®ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ãƒªã‚½ãƒ¼ã‚¹ã¯ï¼ŸA: åŸºæœ¬çš„ã«Terraformã§ç®¡ç† ä¾‹: API Gateway: Terraformï¼ˆè¤‡é›‘ãªè¨­å®šã€è¤‡æ•°Lambdaé€£æºï¼‰ Step Functions: Terraformï¼ˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®šç¾©ï¼‰ EventBridge: ã‚±ãƒ¼ã‚¹ãƒã‚¤ã‚±ãƒ¼ã‚¹ å…±æœ‰Rule â†’ Terraform ç‰¹å®šé–¢æ•°å°‚ç”¨ â†’ Lambrollï¼ˆã¾ãŸã¯ Terraformï¼‰ DynamoDB: Terraformï¼ˆãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ï¼‰ åŸå‰‡: å…±æœ‰ãƒªã‚½ãƒ¼ã‚¹ â†’ Terraform Q10: ãƒãƒ¼ãƒ æ§‹æˆã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã¯ï¼ŸA: ã‚¤ãƒ³ãƒ•ãƒ©1-2åã€ã‚¢ãƒ—ãƒª3-5å å½¹å‰²åˆ†æ‹…: ãƒãƒ¼ãƒ  è²¬ä»» ãƒªãƒã‚¸ãƒˆãƒª ã‚¤ãƒ³ãƒ•ãƒ© VPCã€IAMã€RDSã€Layer terraform-infrastructure ã‚¢ãƒ—ãƒª Lambdaé–¢æ•°ã€ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ lambda-applications ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³: é€±1å›: outputsã®ç¢ºèª Terraformå¤‰æ›´æ™‚: ã‚¢ãƒ—ãƒªãƒãƒ¼ãƒ ã«äº‹å‰é€šçŸ¥ Slacké€£æº: ãƒ‡ãƒ—ãƒ­ã‚¤é€šçŸ¥ ã¾ã¨ã‚ã“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®æœ¬è³ªã‚¨ã‚¤ãƒªã‚¢ã‚¹ã«ã‚ˆã‚‹ç’°å¢ƒåˆ†é›¢ + ãƒ„ãƒ¼ãƒ«ã®è²¬ä»»åˆ†é›¢ 1é€Ÿåº¦ï¼ˆLambrollï¼‰ Ã— å®‰å…¨æ€§ï¼ˆã‚¨ã‚¤ãƒªã‚¢ã‚¹ï¼‰ = æœ€é©ãªCI/CD æ¡ç”¨åˆ¤æ–­ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ Lambdaé–¢æ•°ãŒ20å€‹ä»¥ä¸Šã‚ã‚‹ é€±5å›ä»¥ä¸Šãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ ãƒãƒ¼ãƒ ãŒ3äººä»¥ä¸Šã„ã‚‹ ã‚¤ãƒ³ãƒ•ãƒ©ã¨ã‚¢ãƒ—ãƒªã®åˆ†æ¥­ãŒå¿…è¦ æœ¬ç•ªéšœå®³ãƒªã‚¹ã‚¯ã‚’æœ€å°åŒ–ã—ãŸã„ ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’é«˜é€ŸåŒ–ã—ãŸã„ 3ã¤ä»¥ä¸Šå½“ã¦ã¯ã¾ã‚‹ â†’ æ¡ç”¨ã‚’æ¤œè¨ æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ å°è¦æ¨¡ã§æ¤œè¨¼: 1-2é–¢æ•°ã§è©¦ã™ ãƒãƒ¼ãƒ ã§è­°è«–: ãƒ¡ãƒªãƒƒãƒˆãƒ»ãƒ‡ãƒ¡ãƒªãƒƒãƒˆã‚’å…±æœ‰ æ®µéšçš„å°å…¥: Phase 1ã‹ã‚‰é–‹å§‹ ã•ã‚‰ã«å­¦ã¶å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ Terraform Lambda Provider Lambroll GitHub AWS Lambda Versions and Aliases å‚è€ƒè¨˜äº‹ 1. CI/CDç’°å¢ƒæ§‹ç¯‰ã«ãŠã‘ã‚‹æ–¹é‡ï¼ˆåŸç†åŸå‰‡ï¼‰ 2. æ§‹æˆè¦ç´ ã¨å½¹å‰²ï¼ˆå…¨ä½“åƒï¼‰ 3. å®Ÿè£…ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ï¼ˆå®Ÿè£…æ‰‹é †ï¼‰ ã‚·ãƒªãƒ¼ã‚ºå®ŒãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼ã“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãŒã€ã‚ãªãŸã®ãƒãƒ¼ãƒ ã®Lambdaé‹ç”¨ã‚’æ”¹å–„ã™ã‚‹ä¸€åŠ©ã¨ãªã‚Œã°å¹¸ã„ã§ã™ã€‚ è³ªå•ã‚„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã¯ã€ãƒ–ãƒ­ã‚°ã‚³ãƒ¡ãƒ³ãƒˆã¾ãŸã¯Twitterï¼ˆ@yourhandleï¼‰ã¾ã§ãŠé¡˜ã„ã—ã¾ã™ã€‚ ğŸ‘‰ ç›®æ¬¡ã«æˆ»ã‚‹","link":"/2025/11/02/lambda-cicd-04-tradeoffs/"},{"title":"miseã§ã®Nodeãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†","text":"mise ã®è¨­å®šãƒ¡ãƒ¢ ç’°å¢ƒæƒ…å ± OS macOS Version 15.5 BuildVersion 24F74 ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«12curl https://mise.run | shecho 'eval &quot;$(~/.local/bin/mise activate zsh)&quot;' &gt;&gt; ~/.zshrc ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç¢ºèª1mise doctor Node.jsã®è¨­å®š1234mise ls-remote nodemise use node@22.16.0# ã‚°ãƒ­ãƒ¼ãƒãƒ«ã®å ´åˆmise use -g node@22.16.0 ãƒªãƒã‚¸ãƒˆãƒªå†…ã§ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³æŒ‡å®š.mise.toml 12[tools]node = &quot;22.16.0&quot; 1mise install","link":"/2025/06/22/mise/"},{"title":"Slackã®Incoming Webhooksã«ã¤ã„ã¦","text":"è‡ªåˆ†ã®çŸ¥ã£ã¦ã„ãŸSlackã®Incoming-Webhookã¯Legacyã¨ã—ã¦ã‹ãªã‚Šå‰ã«éæ¨å¥¨ã«ãªã£ã¦ã„ãŸè©±ã€‚ ã‚µãƒãƒ¼ãƒˆã«é–¢ã™ã‚‹æƒ…å ±Discontinuing support for legacy custom bots and classic appsã«ã‚ˆã‚Œã° 2024å¹´6æœˆ: æ–°ã—ã„legacy appsã¨classic appsã®ä½œæˆã‚’ãƒ–ãƒ­ãƒƒã‚¯é–‹å§‹ 2025å¹´3æœˆ31æ—¥: legacy custom botsã®ã‚µãƒãƒ¼ãƒˆçµ‚äº† 2026å¹´5æœˆ25æ—¥: classic appsã®ã‚µãƒãƒ¼ãƒˆçµ‚äº† å…¬é–‹ã•ã‚Œã¦ã„ã‚‹ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ä¸Šè¨˜ã®ã‚‚ã®ã§ã€Legacy Custom Integrationsã«ã‚ãŸã‚‹ã€Legacy Incoming Webhookã¯æ˜ç¢ºã«æœŸæ—¥ã‚’æ±ºã‚ã‚‰ã‚Œã¦ã„ã‚‹ã‚ã‘ã§ã¯ãªã•ãã†ã§ã™ã€‚è‰²ã€…ã¨ä»•æ§˜ã®å¤‰æ›´ã«ã¤ã„ã¦ã¯æ›¸ã‹ã‚Œã¦ã„ã¾ã™ãŒã€åŸºæœ¬çš„ã«ã¯payloadã¨ã—ã¦äº’æ›æ€§ã‚‚ã‚ã‚‹ã®ã§ã€ã²ã¨ã¾ãšç§»è¡Œã—ã¦ã—ã¾ã£ãŸæ–¹ãŒç„¡é›£ã¨ã„ã†çµè«–ã§ã™ã€‚ Legacy Incoming Webhook ã¨ Incoming WebhookLegacy Incoming Webhook Incoming Webhookã§ã‚¢ãƒ—ãƒªã‚’æ¤œç´¢ã™ã‚‹ã¨è¡¨ç¤ºã•ã‚Œã¾ã™ We do not recommend their use. ã¨ã„ã†æ³¨æ„æ›¸ããŒä¸Šéƒ¨ã«ã‚ã‚Šã¾ã™ è¨­å®šç”»é¢ãŒï¼‘ç”»é¢ã§å®Œçµã—ã€éå¸¸ã«ã‚·ãƒ³ãƒ—ãƒ«ã§ã‚ã‹ã‚Šã‚„ã™ãè¨­å®šã§ãã¾ã™ Incoming Webhook Slack Appã‚’ã«ã¦Create New Appã‚’é¸æŠ From scratchã‚’é¸æŠã€App Nameã¨workspaceã‚’å…¥åŠ›ã—ã¦Create Basic Informationã®Display Informationã‚’å…¥åŠ› Features &gt; Incoming Webhooks Activate Incoming Webhooks ã‚’ On ã«ã—ã¾ã™ Add New Webhookã§ã€URLã‚’channelã”ã¨ã«ä½œæˆã—ã¾ã™ ãã‚Œãã‚Œã®é•ã„ Legacy Incoming Webhook ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰å†…ã§usernameã€iconã€channelã‚’ä¸Šæ›¸ãã§ãã‚‹ URLçŸ¥ã£ã¦ãŸã‚‰ã©ã®channelã§ã‚‚æ›¸ãè¾¼ã‚ã‚‹ã‚ã‘ã§ã€ã‚ã¾ã‚Šã‚ˆããªã„ä»•æ§˜ã§ã™ã­ ä½œæˆè€…ãŒçµ„ç¹”ã‚’é›¢ã‚Œã‚‹ã¨WebhookãŒç„¡åŠ¹åŒ–ã•ã‚Œã‚‹ç®¡ç†ä¸Šã®å•é¡ŒãŒã‚ã‚Šã¾ã™ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã¯attachmentsã§è¡¨ç¾ã—ã¾ã™ Incoming Webhook ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã¯Block Kitã‚’ä½¿ç”¨ã—ã¦ã‚ˆã‚Šé«˜åº¦ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä½œæˆãŒå¯èƒ½ã§ã™ ç§»è¡Œæ–¹æ³•ã¯Migrate your legacy message compositions to blocks ãŸã ã—ã€attachmentsã‚‚éæ¨å¥¨ã§ã™ãŒã€ä½¿ãˆã‚‹ã®ã§äº’æ›æ€§ã¯æ‹…ä¿ã•ã‚Œãã†ã§ã™ ç‰¹ã«è‰²æŒ‡å®šã¯attachmentsã—ã‹è¡¨ç¾ã§ããšã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ç·Šæ€¥åº¦ã§è‰²åˆ†ã‘ã—ãŸã„ã‚±ãƒ¼ã‚¹ï¼ˆç›£è¦–ã‚¢ãƒ©ãƒ¼ãƒˆç­‰ï¼‰ã§ã¯ä½¿ã†ã—ã‹ã‚ã‚Šã¾ã›ã‚“ è‰²æŒ‡å®šã«good/warning/dangerã¯ä½¿ãˆãªã„ã¨ã„ã†æƒ…å ±ã‚’è¦‹ã‹ã‘ã¾ã—ãŸãŒã€å•é¡Œãªãä½¿ãˆã¾ã—ãŸã€‚ã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã‚‚OKï¼ˆä¾‹ï¼š#ff0000ï¼‰ attachmentsã§ã®ãƒ†ã‚¹ãƒˆãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ 1234567891011curl -X POST -H 'Content-type: application/json' \\ --data '{ &quot;text&quot;: &quot;Hello, World!&quot;, &quot;attachments&quot;: [ { &quot;color&quot;: &quot;good&quot;, &quot;text&quot;: &quot;This is a test message&quot; } ] }' \\ https://{YOUR_WEBHOOK_URL}","link":"/2025/06/25/slack_webhooks/"},{"title":"uvã§ã®pythonãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã¨ä»®æƒ³ç’°å¢ƒç®¡ç†","text":"uv ã®è¨­å®šãƒ¡ãƒ¢ ç’°å¢ƒæƒ…å ± OS macOS Version 15.5 BuildVersion 24F74 ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«1brew install uv ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆå›è¨­å®šãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§åˆæœŸåŒ–1uv init pyproject.tomlãŒç”Ÿæˆã•ã‚Œã‚‹ãŸã‚ã€pythonãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®š pyproject.toml 1234567...[project]name = &quot;Project Name&quot;version = &quot;0.1.0&quot;description = &quot;Add your description here&quot;readme = &quot;README.md&quot;requires-python = &quot;&gt;=3.13&quot; requirements.txtã®å–ã‚Šè¾¼ã¿1uv add -r requirements.txt requirements.txtã‚’å–ã‚Šè¾¼ã‚“ã å¾Œã¯å‰Šé™¤ã—ã¦ã‚‚OK pyproject.tomlã‚’ã‚‚ã¨ã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«1uv sync dependabot.github/dependabot.yml 123456version: 2updates: - package-ecosystem: &quot;uv&quot; # See documentation for possible values directory: &quot;/&quot; # Location of package manifests schedule: interval: &quot;weekly&quot; .gitignore.gitignore 12345...# uv package manager.uv/uv.lock.uvignore ä½œæ¥­é–‹å§‹æ™‚ä»®æƒ³ç’°å¢ƒã‚’æœ‰åŠ¹åŒ–1. .venv/bin/activate ä½œæ¥­çµ‚äº†æ™‚ä»®æƒ³ç’°å¢ƒã‚’ç„¡åŠ¹åŒ–1deactivate","link":"/2025/06/22/uv/"},{"title":"zed editorã§ã®Bedrockæ¥ç¶šï¼ˆProxyçµŒç”±ï¼‰","text":"zed ã§Amazon Bedrockæ¥ç¶šï¼ˆProxyçµŒç”±ï¼‰ã®è¨­å®šãƒ¡ãƒ¢ ç’°å¢ƒæƒ…å ± OS macOS Version 15.5 å‰æ AWS CLIãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã€ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«è¨­å®šãŒå®Œäº†ã—ã¦ã„ã‚‹ã“ã¨ Bedrockã®ãƒ¢ãƒ‡ãƒ«æœ‰åŠ¹åŒ–AWSãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§åˆ©ç”¨ã—ãŸã„Regionã§Bedrockã®ç”»é¢ã¸ã‚¢ã‚¯ã‚»ã‚¹â€œBedrock configurationsâ€ &gt; â€œãƒ¢ãƒ‡ãƒ«ã‚¢ã‚¯ã‚»ã‚¹â€ ã§æœ‰åŠ¹åŒ–ã—ãŸã„ãƒ¢ãƒ‡ãƒ«ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆ Zed ã§ã®Bedrockã®è¨­å®š Authentication via Named Profile (Recommended) Network Proxy Setting.jsonã‚’ç·¨é›† 1234567&quot;language_models&quot;: { &quot;bedrock&quot;: { &quot;authentication_method&quot;: &quot;named_profile&quot;, &quot;region&quot;: &quot;{your-aws-region}}&quot;, &quot;profile&quot;: &quot;{your-profile-name}&quot; },&quot;proxy&quot;: &quot;http://username:password@proxyserver:port&quot; è¨­å®šå¾Œã€å¿…ãšZedã®å†èµ·å‹•ãŒå¿…è¦","link":"/2025/06/22/zed_bedrock/"},{"title":"zshã¨bashã¯é•ã†","text":"jqã‚’ä½¿ã£ãŸæ™‚ã«æ°—ã¥ã„ãŸè©± bashã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§.items[]ã‚’ãƒªãƒ†ãƒ©ãƒ«ãªæ–‡å­—åˆ—ã¨ã—ã¦æ‰±ã„ã¾ã™ã€‚ 123# bashecho '{&quot;items&quot;: [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]}' | jq -r .items[] | xargs echoa b c zshã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã€ã‚¯ã‚©ãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„å¼•æ•°ã‚’ã‚°ãƒ­ãƒ–ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã—ã¦æ‰±ãŠã†ã¨ã—ã¾ã™ã€‚ 123# zshecho '{&quot;items&quot;: [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]}' | jq -r .items[] | xargs echozsh: no matches found: .items[] zshã§ã“ã®ã‚³ãƒãƒ³ãƒ‰ã‚’æ­£ã—ãå‹•ä½œã•ã›ã‚‹ã«ã¯ã€.items[]ã‚’ã‚¯ã‚©ãƒ¼ãƒˆã§å›²ã‚€å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ 12echo '{&quot;items&quot;: [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]}' | jq -r '.items[]' | xargs echoa b c shellcheckã‚’ä½¿ã†ã¨å®‰å¿ƒMacã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã™ 1brew install shellcheck","link":"/2024/09/07/zsh_bash/"}],"tags":[{"name":"Route53","slug":"Route53","link":"/tags/Route53/"},{"name":"DNS","slug":"DNS","link":"/tags/DNS/"},{"name":"Linux","slug":"Linux","link":"/tags/Linux/"},{"name":"Python","slug":"Python","link":"/tags/Python/"},{"name":"sshd","slug":"sshd","link":"/tags/sshd/"},{"name":"AWS Lambda","slug":"AWS-Lambda","link":"/tags/AWS-Lambda/"},{"name":"CI&#x2F;CD","slug":"CI-CD","link":"/tags/CI-CD/"},{"name":"Terraform","slug":"Terraform","link":"/tags/Terraform/"},{"name":"Lambroll","slug":"Lambroll","link":"/tags/Lambroll/"},{"name":"GitHub Actions","slug":"GitHub-Actions","link":"/tags/GitHub-Actions/"},{"name":"ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£","slug":"ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£","link":"/tags/%E3%82%A2%E3%83%BC%E3%82%AD%E3%83%86%E3%82%AF%E3%83%81%E3%83%A3/"},{"name":"ã‚¤ãƒ³ãƒ•ãƒ©","slug":"ã‚¤ãƒ³ãƒ•ãƒ©","link":"/tags/%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9/"},{"name":"ã‚¨ã‚¤ãƒªã‚¢ã‚¹","slug":"ã‚¨ã‚¤ãƒªã‚¢ã‚¹","link":"/tags/%E3%82%A8%E3%82%A4%E3%83%AA%E3%82%A2%E3%82%B9/"},{"name":"å®Ÿè£…","slug":"å®Ÿè£…","link":"/tags/%E5%AE%9F%E8%A3%85/"},{"name":"é‹ç”¨","slug":"é‹ç”¨","link":"/tags/%E9%81%8B%E7%94%A8/"},{"name":"Node.js","slug":"Node-js","link":"/tags/Node-js/"},{"name":"mise","slug":"mise","link":"/tags/mise/"},{"name":"Slack","slug":"Slack","link":"/tags/Slack/"},{"name":"uv","slug":"uv","link":"/tags/uv/"},{"name":"Zed","slug":"Zed","link":"/tags/Zed/"},{"name":"Bedrock","slug":"Bedrock","link":"/tags/Bedrock/"},{"name":"zsh","slug":"zsh","link":"/tags/zsh/"},{"name":"bash","slug":"bash","link":"/tags/bash/"}],"categories":[{"name":"DNS","slug":"DNS","link":"/categories/DNS/"},{"name":"Linux","slug":"Linux","link":"/categories/Linux/"},{"name":"AWS","slug":"AWS","link":"/categories/AWS/"},{"name":"DevOps","slug":"AWS/DevOps","link":"/categories/AWS/DevOps/"},{"name":"Node.js","slug":"Node-js","link":"/categories/Node-js/"},{"name":"Slack","slug":"Slack","link":"/categories/Slack/"},{"name":"Python","slug":"Python","link":"/categories/Python/"},{"name":"Zed","slug":"Zed","link":"/categories/Zed/"},{"name":"Mac","slug":"Mac","link":"/categories/Mac/"}],"pages":[{"title":"","text":"/* ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒ« - æœ¬æ–‡å¹…ã®èª¿æ•´ */ /* PCè¡¨ç¤ºæ™‚ï¼ˆãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ä»¥ä¸Šï¼‰ã§ãƒ¡ã‚¤ãƒ³ã‚«ãƒ©ãƒ ã®å¹…ã‚’åºƒã’ã‚‹ */ @media screen and (min-width: 1024px) { /* 2ã‚«ãƒ©ãƒ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆå·¦ã‚µã‚¤ãƒ‰ãƒãƒ¼ + ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼‰ */ .is-2-column .column-main.is-8-tablet.is-8-desktop.is-8-widescreen { width: 75% !important; flex: none; } .is-2-column .column-left { width: 25% !important; flex: none; } } /* ãƒ¯ã‚¤ãƒ‰ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ä»¥ä¸Šã§ã•ã‚‰ã«åºƒã’ã‚‹ */ @media screen and (min-width: 1216px) { .is-2-column .column-main.is-8-tablet.is-8-desktop.is-8-widescreen { width: 80% !important; } .is-2-column .column-left { width: 20% !important; } } /* ãƒ•ãƒ«HDç”»é¢ã§ã•ã‚‰ã«æœ€é©åŒ– */ @media screen and (min-width: 1408px) { .is-2-column .column-main.is-8-tablet.is-8-desktop.is-8-widescreen { width: 82% !important; } .is-2-column .column-left { width: 18% !important; } }","link":"/css/custom.css"}]}